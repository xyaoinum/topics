<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Topics API</title>
  <meta content="w3c/CG-DRAFT" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version b06c00b8e, updated Tue Jul 11 13:41:16 2023 -0700" name="generator">
  <link href="https://github.com/patcg-individual-drafts/topics" rel="canonical">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="d75981f52b65aec2dfebd44514dd38815a7d58d4" name="document-revision">
<style>
/* .XXX from https://resources.whatwg.org/standard.css */
.XXX {
  color: #D50606;
  background: white;
  border: solid #D50606;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
</style>
<style>/* Boilerplate: style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */


@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
var { cursor: pointer; }
var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Topics API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2023-07-15">15 July 2023</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://github.com/patcg-individual-drafts/topics">https://github.com/patcg-individual-drafts/topics</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/patcg-individual-drafts/topics/issues/">GitHub</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:yaoxia@chromium.org">Yao Xiao</a> (<span class="p-org org">Google</span>)
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jkarlin@chromium.org">Josh Karlin</a> (<span class="p-org org">Google</span>)
      <dt>Participate:
      <dd><a href="https://github.com/patcg-individual-drafts/topics">GitHub patcg-individual-drafts/topics</a> (<a href="https://github.com/patcg-individual-drafts/topics/issues/new">new issue</a>, <a href="https://github.com/patcg-individual-drafts/topics/issues?state=open">open issues</a>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-software" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification describes a method that could enable ad-targeting based on a person’s general browsing interests without exposing their exact browsing history.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction-header"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#terminology-and-types-header"><span class="secno">2</span> <span class="content">Terminology and types</span></a>
    <li><a href="#user-agent-associated-state-header"><span class="secno">3</span> <span class="content">User agent associated state</span></a>
    <li><a href="#browsing-topic-dictionary-header"><span class="secno">4</span> <span class="content">BrowsingTopic dictionary</span></a>
    <li><a href="#document-id-header"><span class="secno">5</span> <span class="content">document ID</span></a>
    <li><a href="#determine-topics-calculation-input-data-header"><span class="secno">6</span> <span class="content">Determine topics calculation input data</span></a>
    <li><a href="#collect-page-topics-calculation-input-data-header"><span class="secno">7</span> <span class="content">Collect page topics calculation input data</span></a>
    <li><a href="#collect-topics-caller-domain-header"><span class="secno">8</span> <span class="content">Collect topics caller domain</span></a>
    <li><a href="#derive-top-5-topics-header"><span class="secno">9</span> <span class="content">Derive top 5 topics</span></a>
    <li><a href="#periodically-calculate-user-topics-header"><span class="secno">10</span> <span class="content">Periodically calculate user topics</span></a>
    <li><a href="#epochs-for-caller-header"><span class="secno">11</span> <span class="content">Epochs for caller</span></a>
    <li><a href="#get-the-number-of-distinct-versions-in-epochs-header"><span class="secno">12</span> <span class="content">Get the number of distinct versions in epochs</span></a>
    <li><a href="#topics-for-caller-header"><span class="secno">13</span> <span class="content">Topics for caller</span></a>
    <li><a href="#the-javascript-api-header"><span class="secno">14</span> <span class="content">The JavaScript API</span></a>
    <li>
     <a href="#fetch-and-iframe-integration-header"><span class="secno">15</span> <span class="content">fetch() and iframe integration</span></a>
     <ol class="toc">
      <li><a href="#send-browsing-topics-header-boolean-associated-with-request-header"><span class="secno">15.1</span> <span class="content">send browsing topics header boolean associated with Request</span></a>
      <li><a href="#browsing-topics-content-attribute-for-iframe-element-header"><span class="secno">15.2</span> <span class="content">browsingtopics content attribute for HTMLIframeElement</span></a>
      <li><a href="#browsing-topics-attribute-in-request-init-header"><span class="secno">15.3</span> <span class="content">browsingTopics attribute in RequestInit</span></a>
      <li><a href="#modification-to-request-constructor-steps-header"><span class="secno">15.4</span> <span class="content">Modification to request constructor steps</span></a>
      <li><a href="#modification-to-create-navigation-params-by-fetching-steps-header"><span class="secno">15.5</span> <span class="content">Modification to "create navigation params by fetching" steps</span></a>
      <li><a href="#the-sec-browsing-topics-http-request-header-header"><span class="secno">15.6</span> <span class="content">The `<code>Sec-Browsing-Topics</code>` HTTP request header</span></a>
      <li><a href="#modification-to-http-network-or-cache-fetch-algorithm-header"><span class="secno">15.7</span> <span class="content">Modification to HTTP-network-or-cache fetch algorithm</span></a>
      <li><a href="#append-or-modify-a-request-sec-browsing-topics-header-header"><span class="secno">15.8</span> <span class="content">Append or modify a request <code>Sec-Browsing-Topics</code> header</span></a>
      <li><a href="#the-observe-browsing-topics-http-response-header-header"><span class="secno">15.9</span> <span class="content">The `<code>Observe-Browsing-Topics</code>` HTTP response header</span></a>
      <li><a href="#modification-to-http-fetch-steps-header"><span class="secno">15.10</span> <span class="content">Modification to HTTP fetch steps</span></a>
     </ol>
    <li><a href="#permissions-policy-integration-header"><span class="secno">16</span> <span class="content">Permissions policy integration</span></a>
    <li><a href="#privacy-considerations-header"><span class="secno">17</span> <span class="content">Privacy considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <section>
    <h2 class="heading settled" data-level="1" id="introduction-header"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction-header"></a></h2>
    <p>In today’s web, people’s interests are typically inferred based on observing what sites or pages they visit, which relies on tracking techniques like third-party cookies or less-transparent mechanisms like device fingerprinting. It would be better for privacy if interest-based advertising could be accomplished without needing to collect a particular individual’s browsing history.</p>
    <p>This specification provides an API to enable ad-targeting based on a person’s general browsing interests, without exposing their exact browsing history.</p>
    <div class="example" id="example-e14d82fa">
     <a class="self-link" href="#example-e14d82fa"></a> Creating an ad based on browsing interests, using the <code class="idl"><a data-link-type="idl" href="#dom-document-browsingtopics" id="ref-for-dom-document-browsingtopics">document.browsingTopics()</a></code> JavaScript API: 
     <p>(Inside an <code>https://ads.example</code> iframe)</p>
<pre class="lang-js highlight"><c- c1>// document.browsingTopics() returns an array of BrowsingTopic objects.</c->
<c- a>const</c-> topics <c- o>=</c-> <c- k>await</c-> document<c- p>.</c->browsingTopics<c- p>();</c->

<c- c1>// Get data for an ad creative.</c->
<c- a>const</c-> response <c- o>=</c-> <c- k>await</c-> fetch<c- p>(</c-><c- t>'https://ads.example/get-creative'</c-><c- p>,</c-> <c- p>{</c->
  method<c- o>:</c-> <c- t>'POST'</c-><c- p>,</c->
  headers<c- o>:</c-> <c- p>{</c->
    <c- t>'Content-Type'</c-><c- o>:</c-> <c- t>'application/json'</c-><c- p>,</c->
  <c- p>},</c->
  body<c- o>:</c-> JSON<c- p>.</c->stringify<c- p>(</c->topics<c- p>)</c->
<c- p>});</c->

<c- c1>// Get the JSON from the response.</c->
<c- a>const</c-> creative <c- o>=</c-> <c- k>await</c-> response<c- p>.</c->json<c- p>();</c->

<c- c1>// Display the ad.</c->
</pre>
    </div>
    <div class="example" id="example-a1020426">
     <a class="self-link" href="#example-a1020426"></a> Creating an ad based on browsing interests, based on the <span>`<code><a data-link-type="http-header" href="#http-headerdef-sec-browsing-topics" id="ref-for-http-headerdef-sec-browsing-topics">Sec-Browsing-Topics</a></code>`</span> HTTP request header sent by this invocation of <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-global-fetch" id="ref-for-dom-global-fetch">fetch()</a></code>: 
     <p>(Inside the top level context)</p>
<pre class="lang-js highlight"><c- c1>// A 'Sec-Browsing-Topics: [topics header value]' header will be sent in</c->
<c- c1>// the HTTP request.</c->
<c- a>const</c-> response <c- o>=</c-> <c- k>await</c-> fetch<c- p>(</c-><c- t>'https://ads.example/get-creative'</c-><c- p>,</c-> <c- p>{</c->browsingTopics<c- o>:</c-> <c- kc>true</c-><c- p>});</c->
<c- a>const</c-> ad_creative <c- o>=</c-> <c- k>await</c-> response<c- p>.</c->json<c- p>();</c->
<c- c1>// Display the ad.</c->
</pre>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="terminology-and-types-header"><span class="secno">2. </span><span class="content">Terminology and types</span><a class="self-link" href="#terminology-and-types-header"></a></h2>
     A <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-taxonomy">taxonomy</dfn> comprises a list of advertising <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-topic-ids">topic ids</dfn> as integers. A <a data-link-type="dfn" href="#browsing-topics-types-taxonomy" id="ref-for-browsing-topics-types-taxonomy">taxonomy</a> is identified by a <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-taxonomy-version">taxonomy version</dfn> string. A <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids">topic id</a> is no smaller than 1. 
    <p>The taxonomy must be in a tree hierarchy, where an ancestor <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids①">topic id</a> always represents something more general than its descendant <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids②">topic ids</a>. The browser should implement an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-descendant-topics">get descendant topics</dfn> algorithm, which takes in a <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids③">topic id</a>, and returns its descendants <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids④">topic ids</a> as a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a>.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-model-version">model version</dfn> is a string that identifies the <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-model">model</dfn> used to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="classify">classify</dfn> a string into <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids⑤">topic ids</a>. The meaning may vary across browser vendors. The classification result <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids⑥">topic ids</a> should be relevant to the input string’s underlying content.</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-configuration-version">configuration version</dfn> identifies the algorithm (other than the model part) used to calculate the topic. It should take the form of "<code>&lt;browser vendor identifier>.&lt;an integer version></code>". The meaning may vary across browser vendors.</p>
    <p>Given <a data-link-type="dfn" href="#browsing-topics-types-configuration-version" id="ref-for-browsing-topics-types-configuration-version">configuration version</a> <var>configurationVersion</var>, <a data-link-type="dfn" href="#browsing-topics-types-taxonomy-version" id="ref-for-browsing-topics-types-taxonomy-version">taxonomy version</a> <var>taxonomyVersion</var>, and <a data-link-type="dfn" href="#browsing-topics-types-model-version" id="ref-for-browsing-topics-types-model-version">model version</a> <var>modelVersion</var>, the <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-version">version</dfn> is the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string-concatenate" id="ref-for-string-concatenate">concatenating</a> « <var>configurationVersion</var>, <var>taxonomyVersion</var>, <var>modelVersion</var> » using "<code>:</code>".</p>
    <p>The <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-maximum-version-string-length">maximum version string length</dfn> is the maximum possible string length of a <a data-link-type="dfn" href="#browsing-topics-types-version" id="ref-for-browsing-topics-types-version">version</a> that a user agent could possibly generate in a given software release. For example, in Chrome’s experimentation phase, 13 was used for the <a data-link-type="dfn" href="#browsing-topics-types-maximum-version-string-length" id="ref-for-browsing-topics-types-maximum-version-string-length">maximum version string length</a> to account for a version like <code>chrome.1:1:11</code>.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-user-topics-state">user topics state</dfn> is a struct with the following fields and default values:</p>
    <ul>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="user topics state" data-dfn-type="dfn" data-noexport id="user-topics-state-epochs">epochs</dfn>: a list of <a data-link-type="dfn" href="#browsing-topics-types-epoch" id="ref-for-browsing-topics-types-epoch">epoch</a>s, default to an empty list.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="user topics state" data-dfn-type="dfn" data-noexport id="user-topics-state-hmac-key">hmac key</dfn>: 128 bit number, default to 0.</p>
    </ul>
    <p>An <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-epoch">epoch</dfn> is a struct with the following fields:</p>
    <ul>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="epoch" data-dfn-type="dfn" data-noexport id="epoch-taxonomy">taxonomy</dfn>: a list of integers.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="epoch" data-dfn-type="dfn" data-noexport id="epoch-taxonomy-version">taxonomy version</dfn>: a string.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="epoch" data-dfn-type="dfn" data-noexport id="epoch-model-version">model version</dfn>: a string.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="epoch" data-dfn-type="dfn" data-noexport id="epoch-config-version">config version</dfn>: a string.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="epoch" data-dfn-type="dfn" data-noexport id="epoch-top-5-topics-with-caller-domains">top 5 topics with caller domains</dfn>: a list of <a data-link-type="dfn" href="#browsing-topics-types-topic-with-caller-domains" id="ref-for-browsing-topics-types-topic-with-caller-domains">topic with caller domains</a>.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="epoch" data-dfn-type="dfn" data-noexport id="epoch-time">time</dfn>: a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp" id="ref-for-dom-domhighrestimestamp">DOMHighResTimeStamp</a></code> (from Unix epoch).</p>
    </ul>
    <p>A <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-topic-with-caller-domains">topic with caller domains</dfn> is a struct with the following fields:</p>
    <ul>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topic with caller domains" data-dfn-type="dfn" data-noexport id="topic-with-caller-domains-topic-id">topic id</dfn>: an integer.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topic with caller domains" data-dfn-type="dfn" data-noexport id="topic-with-caller-domains-caller-domains">caller domains</dfn>: a set of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain">registrable domains</a>.</p>
    </ul>
    <p>A <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-topics-history-entry">topics history entry</dfn> is a struct with the following fields and default values:</p>
    <ul>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topics history entry" data-dfn-type="dfn" data-noexport id="topics-history-entry-document-id">document id</dfn>: an integer, default to 0.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topics history entry" data-dfn-type="dfn" data-noexport id="topics-history-entry-topics-calculation-input-data">topics calculation input data</dfn>: a string, default to an empty string.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topics history entry" data-dfn-type="dfn" data-noexport id="topics-history-entry-time">time</dfn>: a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp" id="ref-for-dom-domhighrestimestamp①">DOMHighResTimeStamp</a></code> (from Unix epoch).</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topics history entry" data-dfn-type="dfn" data-noexport id="topics-history-entry-topics-caller-domains">topics caller domains</dfn>: an ordered set of <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain①">registrable domains</a>, default to an empty set.</p>
    </ul>
    <p>A <dfn class="dfn-paneled" data-dfn-for="browsing topics types" data-dfn-type="dfn" data-noexport id="browsing-topics-types-topics-caller-context">topics caller context</dfn> is a struct with the following fields:</p>
    <ul>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topics caller context" data-dfn-type="dfn" data-noexport id="topics-caller-context-caller-domain">caller domain</dfn>: a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain②">registrable domain</a>.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topics caller context" data-dfn-type="dfn" data-noexport id="topics-caller-context-top-level-context-domain">top level context domain</dfn>: a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain③">registrable domain</a>.</p>
     <li data-md>
      <p><dfn class="dfn-paneled" data-dfn-for="topics caller context" data-dfn-type="dfn" data-noexport id="topics-caller-context-timestamp">timestamp</dfn>: a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/hr-time/#dom-domhighrestimestamp" id="ref-for-dom-domhighrestimestamp②">DOMHighResTimeStamp</a></code> (from Unix epoch).</p>
    </ul>
    <h2 class="heading settled" data-level="3" id="user-agent-associated-state-header"><span class="secno">3. </span><span class="content">User agent associated state</span><a class="self-link" href="#user-agent-associated-state-header"></a></h2>
     Each <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent">user agent</a> has an associated <a data-link-type="dfn" href="#browsing-topics-types-user-topics-state" id="ref-for-browsing-topics-types-user-topics-state">user topics state</a> <dfn class="dfn-paneled" data-dfn-for="user agent" data-dfn-type="dfn" data-noexport id="user-agent-user-topics-state">user topics state</dfn> with <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs">epochs</a> initially empty, and <a data-link-type="dfn" href="#user-topics-state-hmac-key" id="ref-for-user-topics-state-hmac-key">hmac key</a> initially a randomly generated 128 bit number. 
    <p>Each <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent①">user agent</a> has an associated <dfn class="dfn-paneled" data-dfn-for="user agent" data-dfn-type="dfn" data-noexport id="user-agent-topics-history-storage">topics history storage</dfn> to store the information about the visited pages that are needed for topics calculation. It is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry">topics history entries</a>, initially empty.</p>
    <p>Each <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent②">user agent</a> has an associated <a data-link-type="dfn" href="#browsing-topics-types-taxonomy" id="ref-for-browsing-topics-types-taxonomy①">taxonomy</a> <dfn class="dfn-paneled" data-dfn-for="user agent" data-dfn-type="dfn" data-noexport id="user-agent-taxonomy">taxonomy</dfn> (identified by <a data-link-type="dfn" href="#browsing-topics-types-taxonomy-version" id="ref-for-browsing-topics-types-taxonomy-version①">taxonomy version</a> <dfn class="dfn-paneled" data-dfn-for="user agent" data-dfn-type="dfn" data-noexport id="user-agent-taxonomy-version">taxonomy version</dfn>) and <a data-link-type="dfn" href="#browsing-topics-types-model" id="ref-for-browsing-topics-types-model">model</a> <dfn class="dfn-paneled" data-dfn-for="user agent" data-dfn-type="dfn" data-noexport id="user-agent-model">model</dfn> (identified by <a data-link-type="dfn" href="#browsing-topics-types-model-version" id="ref-for-browsing-topics-types-model-version①">model version</a> <dfn class="dfn-paneled" data-dfn-for="user agent" data-dfn-type="dfn" data-noexport id="user-agent-model-version">model version</dfn>).</p>
    <p>The <a data-link-type="dfn" href="#user-agent-taxonomy" id="ref-for-user-agent-taxonomy">taxonomy</a> and <a data-link-type="dfn" href="#user-agent-model" id="ref-for-user-agent-model">model</a> may be shipped to the browser asynchronously w.r.t. the browser release, and may be unavailable at a given point. They must be updated atomically w.r.t. algorithms that access them (e.g. the <a data-link-type="dfn" href="#calculate-user-topics" id="ref-for-calculate-user-topics">calculate user topics</a> algorithm).</p>
    <p class="note" role="note"><span class="marker">Note:</span> The initial taxonomy used in Chrome is <a href="https://github.com/patcg-individual-drafts/topics/blob/main/taxonomy_v1.md">taxonomy_v1.md</a> and the expectation is that it will change over time.</p>
    <p>Each <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#user-agent" id="ref-for-user-agent③">user agent</a> has an associated topics algorithm configuration (identified by <a data-link-type="dfn" href="#browsing-topics-types-configuration-version" id="ref-for-browsing-topics-types-configuration-version①">configuration version</a> <dfn class="dfn-paneled" data-dfn-for="user agent" data-dfn-type="dfn" data-noexport id="user-agent-configuration-version">configuration version</dfn>). The initial value and meaning is browser defined.</p>
    <p class="note" role="note"><span class="marker">Note:</span> The <a data-link-type="dfn" href="#browsing-topics-types-configuration-version" id="ref-for-browsing-topics-types-configuration-version②">configuration version</a> allows the browser vender to provide algorithms different from the ones specified in this specification. For example, for some of the algorithms in this specification, it may be possible to use a different constant value, while the system overall still has utility and <a href="#privacy-considerations-header">meets the privacy goals</a>.</p>
    <p>When <a data-link-type="dfn" href="#user-agent-configuration-version" id="ref-for-user-agent-configuration-version">configuration version</a> is updated, the browser must properly migrate or delete data in <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state">user topics state</a> and <a data-link-type="dfn" href="#user-agent-topics-history-storage" id="ref-for-user-agent-topics-history-storage">topics history storage</a> so that the state and the configuration are consistent.</p>
    <h2 class="heading settled" data-level="4" id="browsing-topic-dictionary-header"><span class="secno">4. </span><span class="content">BrowsingTopic dictionary</span><a class="self-link" href="#browsing-topic-dictionary-header"></a></h2>
     The <code class="idl"><a data-link-type="idl" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic">BrowsingTopic</a></code> dictionary is used to contain the IDL correspondences of <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids⑦">topic id</a>, <a data-link-type="dfn" href="#browsing-topics-types-version" id="ref-for-browsing-topics-types-version①">version</a>, <a data-link-type="dfn" href="#browsing-topics-types-configuration-version" id="ref-for-browsing-topics-types-configuration-version③">configuration version</a>, <a data-link-type="dfn" href="#browsing-topics-types-taxonomy-version" id="ref-for-browsing-topics-types-taxonomy-version②">taxonomy version</a>, and <a data-link-type="dfn" href="#browsing-topics-types-model-version" id="ref-for-browsing-topics-types-model-version②">model version</a>. 
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-browsingtopic"><code><c- g>BrowsingTopic</c-></code></dfn> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="BrowsingTopic" data-dfn-type="dict-member" data-export data-type="unsigned long long " id="dom-browsingtopic-topic"><code><c- g>topic</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="BrowsingTopic" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-browsingtopic-version"><code><c- g>version</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="BrowsingTopic" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-browsingtopic-configversion"><code><c- g>configVersion</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="BrowsingTopic" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-browsingtopic-modelversion"><code><c- g>modelVersion</c-></code></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="BrowsingTopic" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-browsingtopic-taxonomyversion"><code><c- g>taxonomyVersion</c-></code></dfn>;
};
</pre>
    <div class="example" id="example-22de9750"><a class="self-link" href="#example-22de9750"></a> An example <code class="idl"><a data-link-type="idl" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic①">BrowsingTopic</a></code> object from Chrome: <code class="highlight"><c- p>{</c-> configVersion<c- o>:</c-> <c- u>"chrome.1"</c-><c- p>,</c-> modelVersion<c- o>:</c-> <c- u>"1"</c-><c- p>,</c-> taxonomyVersion<c- o>:</c-> <c- u>"1"</c-><c- p>,</c-> topic<c- o>:</c-> <c- mf>43</c-><c- p>,</c-> version<c- o>:</c-> <c- u>"chrome.1:1:1"</c-> <c- p>}</c-></code>. </div>
    <div class="algorithm" data-algorithm="code unit less than" data-algorithm-for="browsing-topic">
      A <code class="idl"><a data-link-type="idl" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic②">BrowsingTopic</a></code> dictionary <var>a</var> is <dfn class="dfn-paneled" data-dfn-for="browsing-topic" data-dfn-type="dfn" data-noexport id="browsing-topics-dictionary-less-than-comparator">code unit less than</dfn> a <code class="idl"><a data-link-type="idl" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic③">BrowsingTopic</a></code> dictionary <var>b</var> if the following steps return true: 
     <ol>
      <li data-md>
       <p>If <var>a</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-version" id="ref-for-dom-browsingtopic-version">version</a></code>"] is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#code-unit-less-than" id="ref-for-code-unit-less-than">code unit less than</a> <var>b</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-version" id="ref-for-dom-browsingtopic-version①">version</a></code>"], then return true.</p>
      <li data-md>
       <p>If <var>a</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-topic" id="ref-for-dom-browsingtopic-topic">topic</a></code>"] &lt; <var>b</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-topic" id="ref-for-dom-browsingtopic-topic①">topic</a></code>"], then return true.</p>
      <li data-md>
       <p>Return false.</p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="document-id-header"><span class="secno">5. </span><span class="content">document ID</span><a class="self-link" href="#document-id-header"></a></h2>
     Each <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> has a <dfn class="dfn-paneled" data-dfn-for="document-id-header" data-dfn-type="dfn" data-noexport id="document-id-header-document-id">document id</dfn>, which is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> unique identifier shared with no other <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code> objects within or across browser sessions for a user agent. 
    <h2 class="heading settled" data-level="6" id="determine-topics-calculation-input-data-header"><span class="secno">6. </span><span class="content">Determine topics calculation input data</span><a class="self-link" href="#determine-topics-calculation-input-data-header"></a></h2>
     Given a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code>, the browser must have a way to determine the <dfn class="dfn-paneled" data-dfn-for="determine-topics-calculation-input-data-header" data-dfn-type="dfn" data-noexport id="determine-topics-calculation-input-data-header-topics-calculation-input-data">topics calculation input data</dfn>. <a data-link-type="dfn" href="#determine-topics-calculation-input-data-header-topics-calculation-input-data" id="ref-for-determine-topics-calculation-input-data-header-topics-calculation-input-data">topics calculation input data</a> is a string that encodes the attributes to be used for topics classification, as determined by the browser vendor. By default, the attributes should be scoped to the document’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url">URL</a> and <a href="https://html.spec.whatwg.org/multipage/semantics.html#document-metadata">metadata</a>. 
    <p class="note" role="note"><span class="marker">Note:</span> unless specifically allowed, data beyond the document shouldn’t be included, such as data from localStorage or cookies.</p>
    <p class="note" role="note"><span class="marker">Note:</span> In Chrome’s experimentation phase, the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host">host</a> of a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document③">Document</a></code>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url①">URL</a> is used as the <a data-link-type="dfn" href="#determine-topics-calculation-input-data-header-topics-calculation-input-data" id="ref-for-determine-topics-calculation-input-data-header-topics-calculation-input-data①">topics calculation input data</a>, and the model is trained with human curated hostnames and topics.</p>
    <h2 class="heading settled" data-level="7" id="collect-page-topics-calculation-input-data-header"><span class="secno">7. </span><span class="content">Collect page topics calculation input data</span><a class="self-link" href="#collect-page-topics-calculation-input-data-header"></a></h2>
    <div class="algorithm" data-algorithm="collect page topics calculation input data">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="collect-page-topics-calculation-input-data">collect page topics calculation input data</dfn>, given a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document④">Document</a></code> <var>document</var>: 
     <ol>
      <li data-md>
       <p>If <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable">node navigable</a> is a <a data-link-type="dfn" href="https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable" id="ref-for-prerendering-navigable">prerendering navigable</a>, then append the following steps to <var>document</var>’s <a data-link-type="dfn" href="https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list" id="ref-for-platform-object-post-prerendering-activation-steps-list">post-prerendering activation steps list</a> and return. Else, run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
       <ol>
        <li data-md>
         <p>Let <var>documentId</var> be <var>document</var>’s <a data-link-type="dfn" href="#document-id-header-document-id" id="ref-for-document-id-header-document-id">document id</a>.</p>
        <li data-md>
         <p>If user agent’s <a data-link-type="dfn" href="#user-agent-topics-history-storage" id="ref-for-user-agent-topics-history-storage①">topics history storage</a> contains a <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry①">topics history entry</a> whose <a data-link-type="dfn" href="#topics-history-entry-document-id" id="ref-for-topics-history-entry-document-id">document id</a> is <var>documentId</var>, return.</p>
        <li data-md>
         <p>Let <var>topicsHistoryEntry</var> be a <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry②">topics history entry</a>.</p>
        <li data-md>
         <p>Set <var>topicsHistoryEntry</var>’s <a data-link-type="dfn" href="#topics-history-entry-document-id" id="ref-for-topics-history-entry-document-id①">document id</a> to <var>documentId</var>.</p>
        <li data-md>
         <p>Set <var>topicsHistoryEntry</var>’s <a data-link-type="dfn" href="#topics-history-entry-topics-calculation-input-data" id="ref-for-topics-history-entry-topics-calculation-input-data">topics calculation input data</a> to the <a data-link-type="dfn" href="#determine-topics-calculation-input-data-header-topics-calculation-input-data" id="ref-for-determine-topics-calculation-input-data-header-topics-calculation-input-data②">topics calculation input data</a> for <var>document</var>.</p>
        <li data-md>
         <p>Let <var>unsafeMoment</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock">wall clock</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time" id="ref-for-wall-clock-unsafe-current-time">unsafe current time</a>.</p>
        <li data-md>
         <p>Let <var>moment</var> be the result of running <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-coarsen-time" id="ref-for-dfn-coarsen-time">coarsen time</a> algorithm given <var>unsafeMoment</var> and <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock①">wall clock</a> as input.</p>
        <li data-md>
         <p>Let <var>fromUnixEpochTime</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration-from" id="ref-for-dfn-duration-from">duration from</a> the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch">Unix epoch</a> to <var>moment</var>.</p>
        <li data-md>
         <p>Set <var>topicsHistoryEntry</var>’s <a data-link-type="dfn" href="#topics-history-entry-time" id="ref-for-topics-history-entry-time">time</a> to <var>fromUnixEpochTime</var>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> <var>topicsHistoryEntry</var> to user agent’s <a data-link-type="dfn" href="#user-agent-topics-history-storage" id="ref-for-user-agent-topics-history-storage②">topics history storage</a>.</p>
       </ol>
     </ol>
    </div>
    <h2 class="heading settled" data-level="8" id="collect-topics-caller-domain-header"><span class="secno">8. </span><span class="content">Collect topics caller domain</span><a class="self-link" href="#collect-topics-caller-domain-header"></a></h2>
    <div class="algorithm" data-algorithm="collect topics caller domain">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="collect-topics-caller-domain">collect topics caller domain</dfn>, given a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑤">Document</a></code> <var>document</var> and a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain④">registrable domain</a> <var>callerDomain</var>: 
     <ol>
      <li data-md>
       <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>:</p>
       <ol>
        <li data-md>
         <p>Let <var>documentId</var> be <var>document</var>’s <a data-link-type="dfn" href="#document-id-header-document-id" id="ref-for-document-id-header-document-id①">document id</a>.</p>
        <li data-md>
         <p>If user agent’s <a data-link-type="dfn" href="#user-agent-topics-history-storage" id="ref-for-user-agent-topics-history-storage③">topics history storage</a> does not contain a <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry③">topics history entry</a> whose <a data-link-type="dfn" href="#topics-history-entry-document-id" id="ref-for-topics-history-entry-document-id②">document id</a> is <var>documentId</var>, return.</p>
        <li data-md>
         <p>Let <var>topicsHistoryEntry</var> be the <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry④">topics history entry</a> in user agent’s <a data-link-type="dfn" href="#user-agent-topics-history-storage" id="ref-for-user-agent-topics-history-storage④">topics history storage</a> whose <a data-link-type="dfn" href="#topics-history-entry-document-id" id="ref-for-topics-history-entry-document-id③">document id</a> is <var>documentId</var>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>callerDomain</var> to <var>topicsHistoryEntry</var>’s <a data-link-type="dfn" href="#topics-history-entry-topics-caller-domains" id="ref-for-topics-history-entry-topics-caller-domains">topics caller domains</a>.</p>
       </ol>
     </ol>
    </div>
    <h2 class="heading settled" data-level="9" id="derive-top-5-topics-header"><span class="secno">9. </span><span class="content">Derive top 5 topics</span><a class="self-link" href="#derive-top-5-topics-header"></a></h2>
    <p>Given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> of <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry⑤">topics history entries</a> <var>historyEntriesForUserTopics</var>, the browser should provide an algorithm to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="derive-top-5-topics">derive top 5 topics</dfn>, that are believed to be valuable for the Topics callers. The algorithm should return a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a> of 5 <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids⑧">topic ids</a>.</p>
    <div class="note" role="note">
      Chrome’s initial release scores topics by the frequency of page loads with that topic. 
     <div class="example" id="example-5af31995">
      <a class="self-link" href="#example-5af31995"></a> 
      <div class="algorithm" data-algorithm="example-algorithm">
       <p>Given a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">list</a> of <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry⑥">topics history entries</a> <var>historyEntriesForUserTopics</var>:</p>
       <ol>
        <li data-md>
         <p>Let <var>topicsCount</var> be an empty map.</p>
        <li data-md>
         <p>For each <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry⑦">topics history entry</a> <var>historyEntry</var> in <var>historyEntriesForUserTopics</var>:</p>
         <ol>
          <li data-md>
           <p>Let <var>topicIds</var> be the result of <a data-link-type="dfn" href="#classify" id="ref-for-classify">classifying</a> <var>historyEntry</var>’s <a data-link-type="dfn" href="#topics-history-entry-topics-calculation-input-data" id="ref-for-topics-history-entry-topics-calculation-input-data①">topics calculation input data</a>.</p>
          <li data-md>
           <p>For each <var>topicId</var> in <var>topicIds</var>:</p>
           <ol>
            <li data-md>
             <p>If <var>topicsCount</var>[<var>topicId</var>] does not exist:</p>
             <ol>
              <li data-md>
               <p>Initialize <var>topicsCount</var>[<var>topicId</var>] to 0.</p>
             </ol>
            <li data-md>
             <p>Increment <var>topicsCount</var>[<var>topicId</var>] by 1.</p>
           </ol>
         </ol>
        <li data-md>
         <p>Let <var>top5Topics</var> be a list containing the top up to 5 <var>topicId</var>s in <var>topicsCount</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-keys" id="ref-for-map-getting-the-keys">keys</a>, where the <var>topicId</var>s with more count are retrieved first.</p>
        <li data-md>
         <p>If <var>top5Topics</var> has less than 5 entries:</p>
         <ol>
          <li data-md>
           <p>Pad <var>top5Topics</var> with random topic ids from user agent’s <a data-link-type="dfn" href="#user-agent-taxonomy" id="ref-for-user-agent-taxonomy①">taxonomy</a>, until <var>top5Topics</var> has 5 entries.</p>
         </ol>
        <li data-md>
         <p>Return <var>top5Topics</var>.</p>
       </ol>
      </div>
     </div>
    </div>
    <h2 class="heading settled" data-level="10" id="periodically-calculate-user-topics-header"><span class="secno">10. </span><span class="content">Periodically calculate user topics</span><a class="self-link" href="#periodically-calculate-user-topics-header"></a></h2>
    <p>At the start of a browser session, run the <a data-link-type="dfn" href="#schedule-user-topics-calculation" id="ref-for-schedule-user-topics-calculation">schedule user topics calculation</a> algorithm.</p>
    <div class="note" role="note"> This roughly schedules topic calculation every 7 days, unless the browser is inactive at the scheduled time(s), in which case a topic calculation will occur as soon as the browser restarts. </div>
    <div class="algorithm" data-algorithm="schedule user topics calculation">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="schedule-user-topics-calculation">schedule user topics calculation</dfn>, perform the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>unsafeMoment</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock②">wall clock</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time" id="ref-for-wall-clock-unsafe-current-time①">unsafe current time</a>.</p>
      <li data-md>
       <p>Let <var>moment</var> be the result of running <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-coarsen-time" id="ref-for-dfn-coarsen-time①">coarsen time</a> algorithm given <var>unsafeMoment</var> and <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock③">wall clock</a> as input.</p>
      <li data-md>
       <p>Let <var>fromUnixEpochTime</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration-from" id="ref-for-dfn-duration-from①">duration from</a> the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch①">Unix epoch</a> to <var>moment</var>.</p>
      <li data-md>
       <p>Let <var>presumedNextCalculationDelay</var> be a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration">duration</a> of 0.</p>
      <li data-md>
       <p>If user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state①">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs①">epochs</a> is not empty:</p>
       <ol>
        <li data-md>
         <p>Let <var>numEpochs</var> be user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state②">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs②">epochs</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a>.</p>
        <li data-md>
         <p>Let <var>lastTopicsCalculationTime</var> beuser agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state③">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs③">epochs</a>[<var>numEpochs</var> − 1].</p>
        <li data-md>
         <p>Let <var>presumedNextCalculationDelay</var> be <var>lastTopicsCalculationTime</var> + (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration①">duration</a> of 7 days) − <var>fromUnixEpochTime</var>.</p>
        <li data-md>
         <p>If <var>presumedNextCalculationDelay</var> &lt; (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration②">duration</a> of 0), then set <var>presumedNextCalculationDelay</var> to (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration③">duration</a> of 0).</p>
        <li data-md>
         <p>Else if <var>presumedNextCalculationDelay</var> ≥ (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration④">duration</a> of 14 days), then set <var>presumedNextCalculationDelay</var> to (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration⑤">duration</a> of 0).</p>
         <p class="note" role="note"><span class="marker">Note:</span> This could happen if the machine time has gone backward since the last topics calculation. Recalculate immediately to align with the expected schedule rather than potentially stop calculating for a very long time.</p>
       </ol>
      <li data-md>
       <p>Schedule the <a data-link-type="dfn" href="#calculate-user-topics" id="ref-for-calculate-user-topics①">calculate user topics</a> algorithm to run at <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch②">Unix epoch</a> + <var>fromUnixEpochTime</var> + <var>presumedNextCalculationDelay</var>.</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="calculate user topics">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="calculate-user-topics">calculate user topics</dfn>, perform the following steps: 
     <ol>
      <li data-md>
       <p>Let <var>unsafeMoment</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock④">wall clock</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time" id="ref-for-wall-clock-unsafe-current-time②">unsafe current time</a>.</p>
      <li data-md>
       <p>Let <var>moment</var> be the result of running <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-coarsen-time" id="ref-for-dfn-coarsen-time②">coarsen time</a> algorithm given <var>unsafeMoment</var> and <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock⑤">wall clock</a> as input.</p>
      <li data-md>
       <p>Let <var>fromUnixEpochTime</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration-from" id="ref-for-dfn-duration-from②">duration from</a> the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch③">Unix epoch</a> to <var>moment</var>.</p>
      <li data-md>
       <p>If either user agent’s <a data-link-type="dfn" href="#user-agent-model" id="ref-for-user-agent-model①">model</a> or <a data-link-type="dfn" href="#user-agent-taxonomy" id="ref-for-user-agent-taxonomy②">taxonomy</a> isn’t available:</p>
       <ol>
        <li data-md>
         <p>Let <var>epoch</var> be an <a data-link-type="dfn" href="#browsing-topics-types-epoch" id="ref-for-browsing-topics-types-epoch①">epoch</a> struct with default initial field values.</p>
        <li data-md>
         <p>Set <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-time" id="ref-for-epoch-time">time</a> to <var>fromUnixEpochTime</var>.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append①">Append</a> <var>epoch</var> to user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state④">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs④">epochs</a>.</p>
        <li data-md>
         <p>If user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state⑤">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs⑤">epochs</a> has more than 4 entries, remove the oldest epoch (i.e. the epoch with index 0).</p>
        <li data-md>
         <p>Schedule this <a data-link-type="dfn" href="#calculate-user-topics" id="ref-for-calculate-user-topics②">calculate user topics</a> algorithm to run at <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch④">Unix epoch</a> + <var>fromUnixEpochTime</var> + (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration⑥">duration</a> of 7 days).</p>
        <li data-md>
         <p>Return.</p>
       </ol>
      <li data-md>
       <p>Let <var>historyEntriesForUserTopics</var> be an empty list.</p>
      <li data-md>
       <p>Let <var>topicsCallers</var> be an empty map.</p>
      <li data-md>
       <p>Let <var>userTopicsDataStartTime</var> be <var>fromUnixEpochTime</var> − (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration⑦">duration</a> of 7 days).</p>
      <li data-md>
       <p>Let <var>topicsCallerDataStartTime</var> be <var>fromUnixEpochTime</var> − (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration⑧">duration</a> of 21 days).</p>
      <li data-md>
       <p>For each <a data-link-type="dfn" href="#browsing-topics-types-topics-history-entry" id="ref-for-browsing-topics-types-topics-history-entry⑧">topics history entry</a> <var>topicsHistoryEntry</var> in user agent’s <a data-link-type="dfn" href="#user-agent-topics-history-storage" id="ref-for-user-agent-topics-history-storage⑤">topics history storage</a>:</p>
       <ol>
        <li data-md>
         <p>Let <var>visitTime</var> be <var>topicsHistoryEntry</var>’s <a data-link-type="dfn" href="#topics-history-entry-time" id="ref-for-topics-history-entry-time①">time</a>.</p>
        <li data-md>
         <p>If <var>visitTime</var> is before <var>topicsCallerDataStartTime</var>, then continue.</p>
        <li data-md>
         <p>Let <var>topicIds</var> be the result of <a data-link-type="dfn" href="#classify" id="ref-for-classify①">classifying</a> <var>topicsHistoryEntry</var>’s <a data-link-type="dfn" href="#topics-history-entry-topics-calculation-input-data" id="ref-for-topics-history-entry-topics-calculation-input-data②">topics calculation input data</a>.</p>
        <li data-md>
         <p>If <var>visitTime</var> is greater than <var>userTopicsDataStartTime</var>:</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append②">Append</a> <var>topicsHistoryEntry</var> to <var>historyEntriesForUserTopics</var>.</p>
         </ol>
        <li data-md>
         <p>For each <var>topicId</var> in <var>topicIds</var>:</p>
         <ol>
          <li data-md>
           <p>If <var>topicsCallers</var>[<var>topicId</var>] does not exist:</p>
           <ol>
            <li data-md>
             <p>Initialize <var>topicsCallers</var>[<var>topicId</var>] to be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑤">list</a>.</p>
           </ol>
          <li data-md>
           <p>For each <var>callerDomain</var> in <var>topicsHistoryEntry</var>’s <a data-link-type="dfn" href="#topics-history-entry-topics-caller-domains" id="ref-for-topics-history-entry-topics-caller-domains①">topics caller domains</a>:</p>
           <ol>
            <li data-md>
             <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append③">Append</a> <var>callerDomain</var> to <var>topicsCallers</var>[<var>topicId</var>].</p>
           </ol>
         </ol>
       </ol>
      <li data-md>
       <p>Let <var>top5Topics</var> be the result of running <a data-link-type="dfn" href="#derive-top-5-topics" id="ref-for-derive-top-5-topics">derive top 5 topics</a> algorithm, given <var>historyEntriesForUserTopics</var>.</p>
      <li data-md>
       <p>Let <var>top5TopicsWithCallerDomains</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑥">list</a>.</p>
      <li data-md>
       <p>For each <var>topTopicId</var> in <var>top5Topics</var>:</p>
       <ol>
        <li data-md>
         <p>Let <var>topicWithCallerDomains</var> be a <a data-link-type="dfn" href="#browsing-topics-types-topic-with-caller-domains" id="ref-for-browsing-topics-types-topic-with-caller-domains①">topic with caller domains</a> struct with <a data-link-type="dfn" href="#topic-with-caller-domains-topic-id" id="ref-for-topic-with-caller-domains-topic-id">topic id</a> initially 0 and <a data-link-type="dfn" href="#topic-with-caller-domains-caller-domains" id="ref-for-topic-with-caller-domains-caller-domains">caller domains</a> initially empty.</p>
        <li data-md>
         <p>If <var>topTopicId</var> is allowed by user preference setting:</p>
         <ol>
          <li data-md>
           <p>Set <var>topicWithCallerDomains</var>’s <a data-link-type="dfn" href="#topic-with-caller-domains-topic-id" id="ref-for-topic-with-caller-domains-topic-id①">topic id</a> to <var>topicId</var>.</p>
          <li data-md>
           <p>Let <var>topicWithDescendantIds</var> be the result of running <a data-link-type="dfn" href="#get-descendant-topics" id="ref-for-get-descendant-topics">get descendant topics</a> given <var>topTopicId</var>.</p>
          <li data-md>
           <p>Add <var>topTopicId</var> to <var>topicWithDescendantIds</var>.</p>
          <li data-md>
           <p>For each <var>topicId</var> in <var>topicWithDescendantIds</var>:</p>
           <ol>
            <li data-md>
             <p>If <var>topicId</var> is allowed by user preference setting:</p>
             <ol>
              <li data-md>
               <p>Insert all elements in <var>topicsCallers</var>[<var>topicId</var>] to <var>topicWithCallerDomains</var>’s <a data-link-type="dfn" href="#topic-with-caller-domains-caller-domains" id="ref-for-topic-with-caller-domains-caller-domains①">caller domains</a>.</p>
             </ol>
           </ol>
         </ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append④">Append</a> <var>topicWithCallerDomains</var> to <var>top5TopicsWithCallerDomains</var>.</p>
       </ol>
      <li data-md>
       <p>Let <var>epoch</var> be an <a data-link-type="dfn" href="#browsing-topics-types-epoch" id="ref-for-browsing-topics-types-epoch②">epoch</a> struct with default initial field values.</p>
      <li data-md>
       <p>Set <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-taxonomy" id="ref-for-epoch-taxonomy">taxonomy</a> to user agent’s <a data-link-type="dfn" href="#user-agent-taxonomy" id="ref-for-user-agent-taxonomy③">taxonomy</a>.</p>
      <li data-md>
       <p>Set <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-taxonomy-version" id="ref-for-epoch-taxonomy-version">taxonomy version</a> to user agent’s <a data-link-type="dfn" href="#user-agent-taxonomy-version" id="ref-for-user-agent-taxonomy-version">taxonomy version</a>.</p>
      <li data-md>
       <p>Set <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-model-version" id="ref-for-epoch-model-version">model version</a> to user agent’s <a data-link-type="dfn" href="#user-agent-model-version" id="ref-for-user-agent-model-version">model version</a>.</p>
      <li data-md>
       <p>Set <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-config-version" id="ref-for-epoch-config-version">config version</a> to user agent’s <a data-link-type="dfn" href="#user-agent-configuration-version" id="ref-for-user-agent-configuration-version①">configuration version</a>.</p>
      <li data-md>
       <p>Set <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-top-5-topics-with-caller-domains" id="ref-for-epoch-top-5-topics-with-caller-domains">top 5 topics with caller domains</a> to <var>top5TopicsWithCallerDomains</var>.</p>
      <li data-md>
       <p>Set <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-time" id="ref-for-epoch-time①">time</a> to <var>fromUnixEpochTime</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑤">Append</a> <var>epoch</var> to user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state⑥">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs⑥">epochs</a>.</p>
      <li data-md>
       <p>If user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state⑦">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs⑦">epochs</a> has more than 4 entries, remove the oldest epoch.</p>
      <li data-md>
       <p>Schedule this <a data-link-type="dfn" href="#calculate-user-topics" id="ref-for-calculate-user-topics③">calculate user topics</a> algorithm to run at <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch⑤">Unix epoch</a> + <var>fromUnixEpochTime</var> + (a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration⑨">duration</a> of 7 days).</p>
     </ol>
    </div>
    <h2 class="heading settled" data-level="11" id="epochs-for-caller-header"><span class="secno">11. </span><span class="content">Epochs for caller</span><a class="self-link" href="#epochs-for-caller-header"></a></h2>
    <div class="algorithm" data-algorithm="calculate the epochs for caller">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="calculate-the-epochs-for-caller">calculate the epochs for caller</dfn>, given a <a data-link-type="dfn" href="#browsing-topics-types-topics-caller-context" id="ref-for-browsing-topics-types-topics-caller-context">topics caller context</a> <var>callerContext</var>, perform the following steps. They return a list of <a data-link-type="dfn" href="#browsing-topics-types-epoch" id="ref-for-browsing-topics-types-epoch③">epoch</a>. 
     <ol>
      <li data-md>
       <p>Let <var>epochs</var> be user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state⑧">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-epochs" id="ref-for-user-topics-state-epochs⑧">epochs</a>.</p>
      <li data-md>
       <p>If <var>epochs</var> is empty, then return an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑦">list</a>.</p>
      <li data-md>
       <p>Let <var>numEpochs</var> be <var>epochs</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a>.</p>
      <li data-md>
       <p>Let <var>lastEpochTime</var> be <var>epochs</var>[<var>numEpochs</var> − 1]'s <a data-link-type="dfn" href="#epoch-time" id="ref-for-epoch-time②">time</a>.</p>
      <li data-md>
       <p>Let <var>epochSwitchTimeDecisionMessageArray</var> be the concatenation of "epoch-switch-time-decision|" and <var>callerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-top-level-context-domain" id="ref-for-topics-caller-context-top-level-context-domain">top level context domain</a>.</p>
      <li data-md>
       <p>Let <var>epochSwitchTimeDecisionHmacOutput</var> be the output of the <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc6234#section-8.3" id="ref-for-section-8.3">HMAC algorithm</a>, given input parameters: whichSha=SHA256, key=user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state⑨">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-hmac-key" id="ref-for-user-topics-state-hmac-key①">hmac key</a>, and message_array=<var>epochSwitchTimeDecisionMessageArray</var>.</p>
      <li data-md>
       <p>Let <var>epochSwitchTimeDecisionHash</var> be 64 bit truncation of <var>epochSwitchTimeDecisionHmacOutput</var>.</p>
      <li data-md>
       <p>Let <var>epochSwitchTimeDelayIntroduction</var> be a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration" id="ref-for-dfn-duration①⓪">duration</a> of (<var>epochSwitchTimeDecisionHash</var> % 172800) seconds (i.e. 172800 is 2 days in seconds).</p>
      <li data-md>
       <p>Let <var>timestamp</var> be <var>callerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-timestamp" id="ref-for-topics-caller-context-timestamp">timestamp</a>.</p>
      <li data-md>
       <p>Let <var>result</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑧">list</a>.</p>
      <li data-md>
       <p>Let <var>startEpochIndex</var> be -1.</p>
      <li data-md>
       <p>Let <var>endEpochIndex</var> be -1.</p>
      <li data-md>
       <p>If <var>timestamp</var> ≤ <var>lastEpochTime</var> + <var>epochSwitchTimeDelayIntroduction</var>:</p>
       <ol>
        <li data-md>
         <p>Set <var>startEpochIndex</var> to max(<var>numEpochs</var> − 4, 0).</p>
        <li data-md>
         <p>Set <var>endEpochIndex</var> to <var>numEpochs</var> − 2.</p>
       </ol>
      <li data-md>
       <p>Else:</p>
       <ol>
        <li data-md>
         <p>Set <var>startEpochIndex</var> to max(<var>numEpochs</var> − 3, 0).</p>
        <li data-md>
         <p>Set <var>endEpochIndex</var> to <var>numEpochs</var> − 1.</p>
       </ol>
      <li data-md>
       <p>If <var>endEpochIndex</var> ≥ 0:</p>
       <ol>
        <li data-md>
         <p>Let <var>i</var> be <var>startEpochIndex</var>.</p>
        <li data-md>
         <p>While <var>i</var> ≤ <var>endEpochIndex</var>:</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append⑥">Append</a> <var>epochs</var>[<var>i</var>] to <var>result</var>.</p>
          <li data-md>
           <p>Set <var>i</var> to <var>i</var> + 1.</p>
         </ol>
       </ol>
      <li data-md>
       <p>Return <var>result</var>.</p>
     </ol>
    </div>
    <div class="note" role="note"> This roughly returns 3 recently calculated epochs, either counting back from the last epoch, or from the second to the last epoch. The decision depends on whether some fixed duration (between 0 and 2 days, sticky to a user agent &amp; site) has passed since the last epoch was calculated. This essentially adds a per-site fixed delay to the epoch switch time, to make it harder to correlate the same user across sites via the time that topics are changed. The HMAC helps to compute the per-site delay on the fly, without needing to store extra data for each site. </div>
    <h2 class="heading settled" data-level="12" id="get-the-number-of-distinct-versions-in-epochs-header"><span class="secno">12. </span><span class="content">Get the number of distinct versions in epochs</span><a class="self-link" href="#get-the-number-of-distinct-versions-in-epochs-header"></a></h2>
    <div class="algorithm" data-algorithm="get the number of distinct versions in epochs">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-the-number-of-distinct-versions-in-epochs">get the number of distinct versions in epochs</dfn>, given a <a data-link-type="dfn" href="#browsing-topics-types-topics-caller-context" id="ref-for-browsing-topics-types-topics-caller-context①">topics caller context</a> <var>callerContext</var>, perform the following steps. They return an integer. 
     <ol>
      <li data-md>
       <p>Let <var>epochs</var> be the result of running the <a data-link-type="dfn" href="#calculate-the-epochs-for-caller" id="ref-for-calculate-the-epochs-for-caller">calculate the epochs for caller</a> algorithm given <var>callerContext</var> as input.</p>
      <li data-md>
       <p>Let <var>distinctVersions</var> be an empty set.</p>
      <li data-md>
       <p>For each <var>epoch</var> in <var>epochs</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-taxonomy-version" id="ref-for-epoch-taxonomy-version①">taxonomy version</a> is empty (implying that the topics calculation for that epoch didn’t occur), then continue.</p>
        <li data-md>
         <p>Insert tuple (<var>epoch</var>’s <a data-link-type="dfn" href="#epoch-taxonomy-version" id="ref-for-epoch-taxonomy-version②">taxonomy version</a>, <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-model-version" id="ref-for-epoch-model-version①">model version</a>) to distinctVersions.</p>
       </ol>
      <li data-md>
       <p>Return <var>distinctVersions</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size②">size</a>.</p>
     </ol>
    </div>
    <h2 class="heading settled" data-level="13" id="topics-for-caller-header"><span class="secno">13. </span><span class="content">Topics for caller</span><a class="self-link" href="#topics-for-caller-header"></a></h2>
    <div class="algorithm" data-algorithm="calculate the topics for caller">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="calculate-the-topics-for-caller">calculate the topics for caller</dfn>, given a <a data-link-type="dfn" href="#browsing-topics-types-topics-caller-context" id="ref-for-browsing-topics-types-topics-caller-context②">topics caller context</a> <var>callerContext</var>, perform the following steps. They return a list of <code class="idl"><a data-link-type="idl" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic④">BrowsingTopic</a></code>s. 
     <ol>
      <li data-md>
       <p>Let <var>epochs</var> be the result of running the <a data-link-type="dfn" href="#calculate-the-epochs-for-caller" id="ref-for-calculate-the-epochs-for-caller①">calculate the epochs for caller</a> algorithm given <var>callerContext</var> as input.</p>
      <li data-md>
       <p>Let <var>result</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑨">list</a>.</p>
      <li data-md>
       <p>For each <var>epoch</var> in <var>epochs</var>:</p>
       <ol>
        <li data-md>
         <p>If <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-top-5-topics-with-caller-domains" id="ref-for-epoch-top-5-topics-with-caller-domains①">top 5 topics with caller domains</a> is empty (implying the topics calculation failed for that epoch), then continue.</p>
        <li data-md>
         <p>Let <var>topic</var> be null.</p>
        <li data-md>
         <p>Let <var>topTopicIndexDecisionMessageArray</var> be the concatenation of "top-topic-index-decision|", <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-time" id="ref-for-epoch-time③">time</a>, and <var>callerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-top-level-context-domain" id="ref-for-topics-caller-context-top-level-context-domain①">top level context domain</a>.</p>
        <li data-md>
         <p>Let <var>topTopicIndexDecisionHmacOutput</var> be the output of the <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc6234#section-8.3" id="ref-for-section-8.3①">HMAC algorithm</a>, given input parameters: whichSha=SHA256, key=user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state①⓪">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-hmac-key" id="ref-for-user-topics-state-hmac-key②">hmac key</a>, and message_array=<var>topTopicIndexDecisionMessageArray</var>.</p>
        <li data-md>
         <p>Let <var>topTopicIndexDecisionHash</var> be 64 bit truncation of <var>topTopicIndexDecisionHmacOutput</var>.</p>
        <li data-md>
         <p>Let <var>topTopicIndex</var> be <var>topTopicIndexDecisionHash</var> % 5.</p>
        <li data-md>
         <p>Let <var>topTopicWithCallerDomains</var> be <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-top-5-topics-with-caller-domains" id="ref-for-epoch-top-5-topics-with-caller-domains②">top 5 topics with caller domains</a>[<var>topTopicIndex</var>].</p>
        <li data-md>
         <p>If <var>topTopicWithCallerDomains</var>’s <a data-link-type="dfn" href="#topic-with-caller-domains-caller-domains" id="ref-for-topic-with-caller-domains-caller-domains②">caller domains</a> contains <var>callerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-caller-domain" id="ref-for-topics-caller-context-caller-domain">caller domain</a>:</p>
         <ol>
          <li data-md>
           <p>Set <var>topic</var> to an empty <code class="idl"><a data-link-type="idl" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic⑤">BrowsingTopic</a></code> dictionary.</p>
          <li data-md>
           <p>Set <var>topic</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-topic" id="ref-for-dom-browsingtopic-topic②">topic</a></code>"] to <var>topTopicWithCallerDomains</var>’s <a data-link-type="dfn" href="#topic-with-caller-domains-topic-id" id="ref-for-topic-with-caller-domains-topic-id②">topic id</a>.</p>
         </ol>
        <li data-md>
         <p>If <var>topic</var> is null, or if <var>topic</var>’s <code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-topic" id="ref-for-dom-browsingtopic-topic③">topic</a></code> is 0 (i.e. the candidate topic was cleared), then continue.</p>
        <li data-md>
         <p>Let <var>randomOrTopTopicDecisionMessageArray</var> be the concatenation of "random-or-top-topic-decision|", <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-time" id="ref-for-epoch-time④">time</a>, and <var>callerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-top-level-context-domain" id="ref-for-topics-caller-context-top-level-context-domain②">top level context domain</a>.</p>
        <li data-md>
         <p>Let <var>randomOrTopTopicDecisionHmacOutput</var> be the output of the <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc6234#section-8.3" id="ref-for-section-8.3②">HMAC algorithm</a>, given input parameters: whichSha=SHA256, key=user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state①①">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-hmac-key" id="ref-for-user-topics-state-hmac-key③">hmac key</a>, and message_array=<var>randomOrTopTopicDecisionMessageArray</var>.</p>
        <li data-md>
         <p>Let <var>randomOrTopTopicDecisionHash</var> be 64 bit truncation of <var>randomOrTopTopicDecisionHmacOutput</var>.</p>
        <li data-md>
         <p>If <var>randomOrTopTopicDecisionHash</var> % 100 &lt; 5:</p>
         <ol>
          <li data-md>
           <p>Let <var>randomTopicIndexDecisionMessageArray</var> be the concatenation of "random-topic-index-decision|", <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-time" id="ref-for-epoch-time⑤">time</a>, and <var>callerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-top-level-context-domain" id="ref-for-topics-caller-context-top-level-context-domain③">top level context domain</a>.</p>
          <li data-md>
           <p>Let <var>randomTopicIndexDecisionHmacOutput</var> be the output of the <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc6234#section-8.3" id="ref-for-section-8.3③">HMAC algorithm</a>, given input parameters: whichSha=SHA256, key=user agent’s <a data-link-type="dfn" href="#user-agent-user-topics-state" id="ref-for-user-agent-user-topics-state①②">user topics state</a>'s <a data-link-type="dfn" href="#user-topics-state-hmac-key" id="ref-for-user-topics-state-hmac-key④">hmac key</a>, and message_array=<var>randomTopicIndexDecisionMessageArray</var>.</p>
          <li data-md>
           <p>Let <var>randomTopicIndexDecisionHash</var> be 64 bit truncation of <var>randomTopicIndexDecisionHmacOutput</var>.</p>
          <li data-md>
           <p>Let <var>randomTopicIndex</var> be <var>randomTopicIndexDecisionHash</var> % <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-taxonomy" id="ref-for-epoch-taxonomy①">taxonomy</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size③">size</a>.</p>
          <li data-md>
           <p>Set <var>topic</var>’s <code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-topic" id="ref-for-dom-browsingtopic-topic④">topic</a></code> to <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-taxonomy" id="ref-for-epoch-taxonomy②">taxonomy</a>[<var>randomTopicIndex</var>].</p>
         </ol>
        <li data-md>
         <p>Set <var>topic</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-configversion" id="ref-for-dom-browsingtopic-configversion">configVersion</a></code>"] to to <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-config-version" id="ref-for-epoch-config-version①">config version</a>.</p>
        <li data-md>
         <p>Set <var>topic</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-modelversion" id="ref-for-dom-browsingtopic-modelversion">modelVersion</a></code> to"] <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-model-version" id="ref-for-epoch-model-version②">model version</a>.</p>
        <li data-md>
         <p>Set <var>topic</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-taxonomyversion" id="ref-for-dom-browsingtopic-taxonomyversion">taxonomyVersion</a></code>"] to <var>epoch</var>’s <a data-link-type="dfn" href="#epoch-taxonomy-version" id="ref-for-epoch-taxonomy-version③">taxonomy version</a>.</p>
        <li data-md>
         <p>Determine the <a data-link-type="dfn" href="#browsing-topics-types-version" id="ref-for-browsing-topics-types-version②">version</a> <var>version</var>, given <var>topic</var>’s <code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-configversion" id="ref-for-dom-browsingtopic-configversion①">configVersion</a></code>, <code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-modelversion" id="ref-for-dom-browsingtopic-modelversion①">modelVersion</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-taxonomyversion" id="ref-for-dom-browsingtopic-taxonomyversion①">taxonomyVersion</a></code> as input.</p>
        <li data-md>
         <p>Set <var>topic</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-version" id="ref-for-dom-browsingtopic-version②">version</a></code>"] to <var>version</var>.</p>
        <li data-md>
         <p>Add <var>topic</var> to <var>result</var>.</p>
       </ol>
      <li data-md>
       <p>Sort entries in <var>result</var> given the <a href="#browsing-topics-dictionary-less-than-comparator" id="ref-for-browsing-topics-dictionary-less-than-comparator">less-than comparator</a> for the <code class="idl"><a data-link-type="idl" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic⑥">BrowsingTopic</a></code> dictionary.</p>
      <li data-md>
       <p>Remove duplicate entries in <var>result</var>. Two <code class="idl"><a data-link-type="idl" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic⑦">BrowsingTopic</a></code> dictionaries <var>a</var> and <var>b</var> are considered equal if <var>a</var> is not <a data-link-type="dfn" href="#browsing-topics-dictionary-less-than-comparator" id="ref-for-browsing-topics-dictionary-less-than-comparator②">code unit less than</a> <var>b</var> and <var>b</var> is not <a data-link-type="dfn" href="#browsing-topics-dictionary-less-than-comparator" id="ref-for-browsing-topics-dictionary-less-than-comparator①">code unit less than</a> <var>a</var>.</p>
      <li data-md>
       <p>Return <var>result</var>.</p>
     </ol>
    </div>
    <div class="note" role="note"> This roughly selects one random topic from each of the previous epochs (to limit cross-site reidentification capabilities), and only returns those that were observed by the caller (so that this provides roughly only a subset of the capabilities of third-party cookies). For each epoch, there is a 5% chance to return a random topic from the full taxonomy, rather than returning the real top topic, so as to provide some amount of plausible deniability. This random topic will only be returned if the caller would have received the real top topic (i.e. observed by the caller). This makes it non-trivial to detect which topics are the random topics (see <a href="https://github.com/patcg-individual-drafts/topics/issues/75">github issue</a>). All the randomnesses involved in this process are sticky to the user agent, epoch, and site. The HMAC helps to compute the random sticky values on the fly, without needing to store extra data for each epoch and site. </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="14" id="the-javascript-api-header"><span class="secno">14. </span><span class="content">The JavaScript API</span><a class="self-link" href="#the-javascript-api-header"></a></h2>
    <p>The Topics API lives under the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑥">Document</a></code> interface, and is only available if the document is in <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" id="ref-for-secure-context">secure context</a>.</p>
<pre class="idl highlight def"><c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-browsingtopicsoptions"><code><c- g>BrowsingTopicsOptions</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="false" data-dfn-for="BrowsingTopicsOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-browsingtopicsoptions-skipobservation"><code><c- g>skipObservation</c-></code></dfn> = <c- b>false</c->;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document" id="ref-for-document⑦"><c- g>Document</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-browsingtopic" id="ref-for-dictdef-browsingtopic⑧"><c- n>BrowsingTopic</c-></a>>> <a class="idl-code" data-link-type="method" href="#dom-document-browsingtopics" id="ref-for-dom-document-browsingtopics①"><c- g>browsingTopics</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-browsingtopicsoptions" id="ref-for-dictdef-browsingtopicsoptions"><c- n>BrowsingTopicsOptions</c-></a> <dfn class="idl-code" data-dfn-for="Document/browsingTopics(options), Document/browsingTopics()" data-dfn-type="argument" data-export id="dom-document-browsingtopics-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-document-browsingtopics-options-options"></a></dfn> = {});
};
</pre>
    <div class="algorithm" data-algorithm="browsingTopics(options)">
      The <dfn class="dfn-paneled idl-code" data-dfn-for="Document" data-dfn-type="method" data-export data-lt="browsingTopics(options)|browsingTopics()" id="dom-document-browsingtopics"><code>browsingTopics(options)</code></dfn> method steps are: 
     <ol>
      <li data-md>
       <p>Let <var>document</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>.</p>
      <li data-md>
       <p>Let <var>topLevelDocument</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable①">node navigable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top">top-level traversable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document">active document</a>.</p>
      <li data-md>
       <p>Let <var>promise</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-new-promise" id="ref-for-a-new-promise">a new promise</a>.</p>
      <li data-md>
       <p>Let <var>topicsCallerContext</var> be a <a data-link-type="dfn" href="#browsing-topics-types-topics-caller-context" id="ref-for-browsing-topics-types-topics-caller-context③">topics caller context</a>.</p>
      <li data-md>
       <p>Set <var>topicsCallerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-caller-domain" id="ref-for-topics-caller-context-caller-domain①">caller domain</a> to <var>document</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin">origin</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host">host</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑤">registrable domain</a>.</p>
      <li data-md>
       <p>Set <var>topicsCallerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-top-level-context-domain" id="ref-for-topics-caller-context-top-level-context-domain④">top level context domain</a> to <var>topLevelDocument</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin①">origin</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host①">host</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑥">registrable domain</a>.</p>
      <li data-md>
       <p>Let <var>unsafeMoment</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock⑥">wall clock</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time" id="ref-for-wall-clock-unsafe-current-time③">unsafe current time</a>.</p>
      <li data-md>
       <p>Let <var>moment</var> be the result of running <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-coarsen-time" id="ref-for-dfn-coarsen-time③">coarsen time</a> algorithm given <var>unsafeMoment</var> and <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock⑦">wall clock</a> as input.</p>
      <li data-md>
       <p>Let <var>fromUnixEpochTime</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration-from" id="ref-for-dfn-duration-from③">duration from</a> the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch⑥">Unix epoch</a> to <var>moment</var>.</p>
      <li data-md>
       <p>Set <var>topicsCallerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-timestamp" id="ref-for-topics-caller-context-timestamp①">timestamp</a> to <var>fromUnixEpochTime</var>.</p>
      <li data-md>
       <p>If any of the following is true:</p>
       <ul>
        <li data-md>
         <p><var>document</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin②">origin</a> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque" id="ref-for-concept-origin-opaque">opaque origin</a>.</p>
        <li data-md>
         <p><var>document</var> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" id="ref-for-allowed-to-use">allowed to use</a> the <code><a href="#browsing-topics-policy-controlled-feature" id="ref-for-browsing-topics-policy-controlled-feature">browsing-topics</a></code> feature.</p>
        <li data-md>
         <p><var>document</var> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use" id="ref-for-allowed-to-use①">allowed to use</a> the <code><a href="#interest-cohort-policy-controlled-feature" id="ref-for-interest-cohort-policy-controlled-feature">interest-cohort</a></code> feature.</p>
        <li data-md>
         <p>The user preference setting disallows the access to topics from <var>topLevelDocument</var> given <var>document</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin③">origin</a>.</p>
       </ul>
       <p class="note" role="note"><span class="marker">Note:</span> In Chrome’s experimentation phase, it will additionally require a valid <a href="https://github.com/GoogleChrome/OriginTrials/blob/gh-pages/explainer.md">Origin Trial</a> token to exist in <var>document</var>.</p>
       <p>then:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">Queue a global task</a> on the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="browsing-topics-task-source">browsing topics task source</dfn> given <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a> to <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#reject" id="ref-for-reject">reject</a> <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
        <li data-md>
         <p>Abort these steps.</p>
       </ol>
      <li data-md>
       <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>:</p>
       <ol>
        <li data-md>
         <p>Let <var>topics</var> be the result of running the <a data-link-type="dfn" href="#calculate-the-topics-for-caller" id="ref-for-calculate-the-topics-for-caller">calculate the topics for caller</a> algorithm, with <var>topicsCallerContext</var> as input.</p>
        <li data-md>
         <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopicsoptions-skipobservation" id="ref-for-dom-browsingtopicsoptions-skipobservation">skipObservation</a></code>"] is false:</p>
         <ol>
          <li data-md>
           <p>Run the <a data-link-type="dfn" href="#collect-page-topics-calculation-input-data" id="ref-for-collect-page-topics-calculation-input-data">collect page topics calculation input data</a> algorithm with <var>topLevelDocument</var> as input.</p>
          <li data-md>
           <p>Run the <a data-link-type="dfn" href="#collect-topics-caller-domain" id="ref-for-collect-topics-caller-domain">collect topics caller domain</a> algorithm with <var>topLevelDocument</var> and <var>topicsCallerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-caller-domain" id="ref-for-topics-caller-context-caller-domain②">caller domain</a> as input.</p>
         </ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task①">Queue a global task</a> on the <a data-link-type="dfn" href="#browsing-topics-task-source" id="ref-for-browsing-topics-task-source">browsing topics task source</a> given <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a> to perform the following steps:</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#resolve" id="ref-for-resolve">Resolve</a> <var>promise</var> with <var>topics</var>.</p>
         </ol>
       </ol>
      <li data-md>
       <p>Return <var>promise</var>.</p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="15" id="fetch-and-iframe-integration-header"><span class="secno">15. </span><span class="content">fetch() and iframe integration</span><a class="self-link" href="#fetch-and-iframe-integration-header"></a></h2>
     Topics can be sent in the HTTP header for <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-global-fetch" id="ref-for-dom-global-fetch①">fetch()</a></code> requests and for <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#navigate-an-iframe-or-frame">iframe navigation</a> requests. The response header for a topics related request can specify whether the caller should to be recorded. 
    <h3 class="heading settled" data-level="15.1" id="send-browsing-topics-header-boolean-associated-with-request-header"><span class="secno">15.1. </span><span class="content">send browsing topics header boolean associated with Request</span><a class="self-link" href="#send-browsing-topics-header-boolean-associated-with-request-header"></a></h3>
     A <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> has an associated <dfn class="dfn-paneled" data-dfn-for="request" data-dfn-type="dfn" data-noexport id="request-send-browsing-topics-header-boolean">send browsing topics header boolean</dfn>. Unless stated otherwise it is false. 
    <p><span class="XXX">TODO: make the modification directly to the fetch spec.</span></p>
    <h3 class="heading settled" data-level="15.2" id="browsing-topics-content-attribute-for-iframe-element-header"><span class="secno">15.2. </span><span class="content">browsingtopics content attribute for HTMLIframeElement</span><a class="self-link" href="#browsing-topics-content-attribute-for-iframe-element-header"></a></h3>
     The <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="63353a1a0">iframe</a> element contains a <dfn class="dfn-paneled" data-dfn-for="iframe" data-dfn-type="element-attr" data-export id="element-attrdef-iframe-browsingtopics"><code>browsingtopics</code></dfn> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes">content attribute</a>. The IDL attribute <dfn class="dfn-paneled idl-code" data-dfn-for="HTMLIFrameElement" data-dfn-type="attribute" data-export id="dom-htmliframeelement-browsingtopics"><code>browsingTopics</code></dfn> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect" id="ref-for-reflect">reflects</a> the <code><a data-link-type="element-sub" href="#element-attrdef-iframe-browsingtopics" id="ref-for-element-attrdef-iframe-browsingtopics">browsingtopics</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes①">content attribute</a>. 
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement" id="ref-for-htmliframeelement"><c- g>HTMLIFrameElement</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions" id="ref-for-cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-type="boolean" href="#dom-htmliframeelement-browsingtopics" id="ref-for-dom-htmliframeelement-browsingtopics"><c- g>browsingTopics</c-></a>;
};
</pre>
    <p><span class="XXX">TODO: make the modification directly to the html spec.</span></p>
    <h3 class="heading settled" data-level="15.3" id="browsing-topics-attribute-in-request-init-header"><span class="secno">15.3. </span><span class="content">browsingTopics attribute in RequestInit</span><a class="self-link" href="#browsing-topics-attribute-in-request-init-header"></a></h3>
     The <a href="https://fetch.spec.whatwg.org/#requestinit" id="177d70c80">RequestInit</a> dictionary contains a browsingTopics attribute: 
<pre class="idl highlight def"><c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://fetch.spec.whatwg.org/#requestinit" id="ref-for-requestinit"><c- g>RequestInit</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean②"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="RequestInit" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-requestinit-browsingtopics"><code><c- g>browsingTopics</c-></code></dfn>;
};
</pre>
    <p><span class="XXX">TODO: make the modification directly to the fetch spec.</span></p>
    <h3 class="heading settled" data-level="15.4" id="modification-to-request-constructor-steps-header"><span class="secno">15.4. </span><span class="content">Modification to request constructor steps</span><a class="self-link" href="#modification-to-request-constructor-steps-header"></a></h3>
     The following step will be added to the <a href="https://fetch.spec.whatwg.org/#dom-request">new Request(input, init) constructor steps</a>, before step "Set this’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request">request</a> to <var>request</var>": 
    <ol>
     <li data-md>
      <p>If <var>init</var>["<code class="idl"><a data-link-type="idl" href="#dom-requestinit-browsingtopics" id="ref-for-dom-requestinit-browsingtopics">browsingTopics</a></code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a>, then set <var>request</var>’s <a data-link-type="dfn" href="#request-send-browsing-topics-header-boolean" id="ref-for-request-send-browsing-topics-header-boolean">send browsing topics header boolean</a> to it.</p>
    </ol>
    <p><span class="XXX">TODO: make the modification directly to the fetch spec.</span></p>
    <h3 class="heading settled" data-level="15.5" id="modification-to-create-navigation-params-by-fetching-steps-header"><span class="secno">15.5. </span><span class="content">Modification to "create navigation params by fetching" steps</span><a class="self-link" href="#modification-to-create-navigation-params-by-fetching-steps-header"></a></h3>
     The following step will be added to the <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching">create navigation params by fetching steps</a>, after step "Let <var>request</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request①">request</a>, with ...": 
    <ol>
     <li data-md>
      <p>If <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-container" id="ref-for-nav-container">container</a> is an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code> element, and if it has a <code><a data-link-type="element-sub" href="#element-attrdef-iframe-browsingtopics" id="ref-for-element-attrdef-iframe-browsingtopics①">browsingtopics</a></code> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes" id="ref-for-concept-element-attributes②">content attribute</a>, then set <var>request</var>’s <a data-link-type="dfn" href="#request-send-browsing-topics-header-boolean" id="ref-for-request-send-browsing-topics-header-boolean①">send browsing topics header boolean</a> to true.</p>
    </ol>
    <p><span class="XXX">TODO: make the modification directly to the html spec.</span></p>
    <h3 class="heading settled" data-level="15.6" id="the-sec-browsing-topics-http-request-header-header"><span class="secno">15.6. </span><span class="content">The `<code>Sec-Browsing-Topics</code>` HTTP request header</span><a class="self-link" href="#the-sec-browsing-topics-http-request-header-header"></a></h3>
    <p>This specification defines a `<dfn class="dfn-paneled" data-dfn-type="http-header" data-export id="http-headerdef-sec-browsing-topics"><code>Sec-Browsing-Topics</code></dfn>` HTTP request header. It is used to send the topics.</p>
    <h3 class="heading settled" data-level="15.7" id="modification-to-http-network-or-cache-fetch-algorithm-header"><span class="secno">15.7. </span><span class="content">Modification to HTTP-network-or-cache fetch algorithm</span><a class="self-link" href="#modification-to-http-network-or-cache-fetch-algorithm-header"></a></h3>
     The following step will be added to the <a href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a> algorithm, before step "Modify <var>httpRequest</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a> per HTTP. ...": 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#append-or-modify-a-request-sec-browsing-topics-header" id="ref-for-append-or-modify-a-request-sec-browsing-topics-header">Append or modify a request `<code>Sec-Browsing-Topics</code>` header</a> for <var>httpRequest</var>.</p>
    </ol>
    <p><span class="XXX">TODO: make the modification directly to the fetch spec.</span></p>
    <h3 class="heading settled" data-level="15.8" id="append-or-modify-a-request-sec-browsing-topics-header-header"><span class="secno">15.8. </span><span class="content">Append or modify a request <code>Sec-Browsing-Topics</code> header</span><a class="self-link" href="#append-or-modify-a-request-sec-browsing-topics-header-header"></a></h3>
    <div class="algorithm" data-algorithm="append or modify a request `Sec-Browsing-Topics` header">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="append-or-modify-a-request-sec-browsing-topics-header">append or modify a request `<code>Sec-Browsing-Topics</code>` header</dfn>, given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> <var>request</var>, run these steps: 
     <ol>
      <li data-md>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="#request-send-browsing-topics-header-boolean" id="ref-for-request-send-browsing-topics-header-boolean②">send browsing topics header boolean</a> is not true, then return.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-delete" id="ref-for-concept-header-list-delete">Delete</a> <span>`<code><a data-link-type="http-header" href="#http-headerdef-sec-browsing-topics" id="ref-for-http-headerdef-sec-browsing-topics①">Sec-Browsing-Topics</a></code>`</span> from <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list" id="ref-for-concept-header-list">header list</a>.</p>
       <p class="note" role="note"> The topics a request is allowed to see can change within its redirect chain. For example, different caller domains may receive different topics, as the callers can only get the topics about the sites they were on. The timestamp can also affect the candidate epochs where the topics are derived from, thus resulting in different topics across redirects. </p>
      <li data-md>
       <p>Let <var>initiatorWindow</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-window" id="ref-for-concept-request-window">window</a>.</p>
      <li data-md>
       <p>Let <var>requestOrigin</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>.</p>
      <li data-md>
       <p>If <var>requestOrigin</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin" id="ref-for-potentially-trustworthy-origin">potentially trustworthy origin</a>, then return.</p>
      <li data-md>
       <p>If <var>initiatorWindow</var> is not an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a>, then return.</p>
      <li data-md>
       <p>If <var>initiatorWindow</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#secure-context" id="ref-for-secure-context①">secure context</a>, then return.</p>
      <li data-md>
       <p>For each feature <var>f</var> in « "<code>browsing-topic</code>", "<code>interest-cohort</code>" »:</p>
       <ol>
        <li data-md>
         <p>Run the <a href="https://www.w3.org/TR/permissions-policy-1/#algo-should-request-be-allowed-to-use-feature">Should request be allowed to use feature?</a> algorithm with <var>feature</var> set to <var>f</var> and <var>request</var> set to <var>request</var>. If the algorithm returns false, then return.</p>
       </ol>
       <p class="note" role="note"><span class="marker">Note:</span> the above algorithm should include the <a href="https://github.com/w3c/webappsec-permissions-policy/pull/499">pending update</a>, i.e. the <var>request</var> should be considered to contain the equivalent opt-in flags for both "browsing-topic" and the "interest-cohort" feature.</p>
      <li data-md>
       <p>Let <var>topLevelDocument</var> be <var>initiatorWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable" id="ref-for-window-navigable">navigable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top①">top-level traversable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document①">active document</a>.</p>
      <li data-md>
       <p>Let <var>topicsCallerContext</var> be a <a data-link-type="dfn" href="#browsing-topics-types-topics-caller-context" id="ref-for-browsing-topics-types-topics-caller-context④">topics caller context</a> with default initial field values.</p>
      <li data-md>
       <p>Set <var>topicsCallerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-caller-domain" id="ref-for-topics-caller-context-caller-domain③">caller domain</a> to <var>requestOrigin</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host②">host</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑦">registrable domain</a>.</p>
      <li data-md>
       <p>Set <var>topicsCallerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-top-level-context-domain" id="ref-for-topics-caller-context-top-level-context-domain⑤">top level context domain</a> to <var>topLevelDocument</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-origin" id="ref-for-concept-document-origin④">origin</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host③">host</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑧">registrable domain</a>.</p>
      <li data-md>
       <p>Let <var>unsafeMoment</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock⑧">wall clock</a>'s <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time" id="ref-for-wall-clock-unsafe-current-time④">unsafe current time</a>.</p>
      <li data-md>
       <p>Let <var>moment</var> be the result of running <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-coarsen-time" id="ref-for-dfn-coarsen-time④">coarsen time</a> algorithm given <var>unsafeMoment</var> and <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-wall-clock" id="ref-for-dfn-wall-clock⑨">wall clock</a> as input.</p>
      <li data-md>
       <p>Let <var>fromUnixEpochTime</var> be the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-duration-from" id="ref-for-dfn-duration-from④">duration from</a> the <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-unix-epoch" id="ref-for-dfn-unix-epoch⑦">Unix epoch</a> to <var>moment</var>.</p>
      <li data-md>
       <p>Set <var>topicsCallerContext</var>’s <a data-link-type="dfn" href="#topics-caller-context-timestamp" id="ref-for-topics-caller-context-timestamp②">timestamp</a> to <var>fromUnixEpochTime</var>.</p>
      <li data-md>
       <p>If the user preference setting disallows the access to topics from <var>topLevelDocument</var> given <var>requestOrigin</var>, then return.</p>
      <li data-md>
       <p>Let <var>topics</var> be the result of running the <a data-link-type="dfn" href="#calculate-the-topics-for-caller" id="ref-for-calculate-the-topics-for-caller①">calculate the topics for caller</a> algorithm, with <var>topicsCallerContext</var> as input.</p>
      <li data-md>
       <p>Let <var>numVersionsInEpochs</var> be the result of running the <a data-link-type="dfn" href="#get-the-number-of-distinct-versions-in-epochs" id="ref-for-get-the-number-of-distinct-versions-in-epochs">get the number of distinct versions in epochs</a> algorithm, with <var>topicsCallerContext</var> as input.</p>
      <li data-md>
       <p>Let <var>versionsToTopics</var> be an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">ordered map</a>.</p>
      <li data-md>
       <p>For each <var>topic</var> of <var>topics</var>:</p>
       <ol>
        <li data-md>
         <p>Let <var>version</var> be <var>topic</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-version" id="ref-for-dom-browsingtopic-version③">version</a></code>"].</p>
        <li data-md>
         <p>Let <var>topicInteger</var> be <var>topic</var>["<code class="idl"><a data-link-type="idl" href="#dom-browsingtopic-topic" id="ref-for-dom-browsingtopic-topic⑤">topic</a></code>"].</p>
        <li data-md>
         <p>If <var>versionsToTopics</var>[<var>version</var>] does not exist, then set it to an empty list.</p>
        <li data-md>
         <p>Append <var>topicInteger</var> to <var>versionsToTopics</var>[<var>version</var>].</p>
       </ol>
      <li data-md>
       <p>Let <var>topicsStructuredFieldsList</var> be an empty <a href="https://www.rfc-editor.org/rfc/rfc8941.html#name-lists">Structured Fields List</a>.</p>
      <li data-md>
       <p>For each <var>version</var> → <var>topicIntegers</var> of <var>versionsToTopics</var>:</p>
       <ol>
        <li data-md>
         <p>Let <var>innerList</var> be an empty <a href="https://www.rfc-editor.org/rfc/rfc8941.html#name-inner-lists">Structured Fields Inner List</a>.</p>
        <li data-md>
         <p>Append all items from <var>topicIntegers</var> to <var>innerList</var>.</p>
        <li data-md>
         <p>Let <var>topicParameters</var> be an empty <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc8941.html#name-parameters" id="ref-for-name-parameters">Structured Fields Parameters</a>.</p>
        <li data-md>
         <p>Set <var>topicParameters</var>["<code>v</code>"] to a <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc8941.html#name-tokens" id="ref-for-name-tokens">Structured Fields Token</a> with value <var>version</var>.</p>
        <li data-md>
         <p>Associate <var>topicParameters</var> with <var>innerList</var>.</p>
        <li data-md>
         <p>Append <var>innerList</var> to <var>topicsStructuredFieldsList</var>.</p>
       </ol>
      <li data-md>
       <p>If <var>numVersionsInEpochs</var> is 0, then set <var>numVersionsInEpochs</var> to 1.</p>
      <li data-md>
       <p>Let <var>maxNumberOfEpochs</var> be 3 (i.e. topics are selected from the last 3 epochs).</p>
      <li data-md>
       <p>Let <var>topicMaxLength</var> be number of base-10 digits in the maximum <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids⑨">topic id</a> (e.g. for <a href="https://github.com/patcg-individual-drafts/topics/blob/main/taxonomy_v1.md">Chrome’s initial taxonomy</a>, <var>topicMaxLength</var> is 3, as the <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids①⓪">topic id</a> has maximum 3 digits).</p>
      <li data-md>
       <p>Let <var>versionMaxLength</var> be the length of the current <a data-link-type="dfn" href="#browsing-topics-types-maximum-version-string-length" id="ref-for-browsing-topics-types-maximum-version-string-length①">maximum version string length</a>.</p>
      <li data-md>
       <p>Let <var>listItemsSeparatorLength</var> be 2 (i.e. structured fields use a two characters (", ") to separate list items).</p>
      <li data-md>
       <p>Let <var>perVersionedTopicsInnerListOverhead</var> be 5 (i.e. for "();v=")</p>
      <li data-md>
       <p>Let <var>maxPaddingLength</var> be <var>maxNumberOfEpochs</var> * <var>topicMaxLength</var> + <var>maxNumberOfEpochs</var> - <var>numVersionsInEpochs</var> + <var>numVersionsInEpochs</var> * <var>perVersionedTopicsInnerListOverhead</var> + <var>numVersionsInEpochs</var> * <var>versionMaxLength</var> + (numVersionsInEpochs - 1) * <var>listItemsSeparatorLength</var>.</p>
      <li data-md>
       <p>Let <var>paddingLength</var> be <var>maxPaddingLength</var>.</p>
      <li data-md>
       <p>If <var>topicsStructuredFieldsList</var> is not empty:</p>
       <ol>
        <li data-md>
         <p>Let <var>serializedTopicsList</var> be the result of executing the <a href="https://httpwg.org/specs/rfc8941.html#text-serialize">serializing structured fields</a> algorithm on <var>topicsStructuredFieldsList</var>.</p>
        <li data-md>
         <p>Decrement <var>paddingLength</var> by <var>serializedTopicsList</var>’s length.</p>
       </ol>
      <li data-md>
       <p>Else:</p>
       <ol>
        <li data-md>
         <p>Increment <var>paddingLength</var> by <var>listItemsSeparatorLength</var> (i.e. to account for the separator characters that would be added when <var>topics</var> are not empty).</p>
       </ol>
      <li data-md>
       <p>If <var>paddingLength</var> &lt; 0, then set <var>paddingLength</var> to 0.</p>
     </ol>
     <p class="note" role="note"><span class="marker">Note:</span> the padding should generally be ≥ 0. It may be negative in certain circumstances: when historically stored topic versions are greater (and use more digits) than the current <a data-link-type="dfn" href="#browsing-topics-types-maximum-version-string-length" id="ref-for-browsing-topics-types-maximum-version-string-length②">maximum version string length</a>; or when there is a race between getting topics and getting the number of distinct topic versions. Clamp to 0 to prevent breakage in these rare circumstances.</p>
     <ol>
      <li data-md>
       <p>Let <var>paddedToken</var> be "P".</p>
      <li data-md>
       <p>Append <var>paddingLength</var> <code>"0"</code> characters to the end of <var>paddedToken</var>.</p>
      <li data-md>
       <p>Let <var>paddedEntryParameters</var> be an empty <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc8941.html#name-parameters" id="ref-for-name-parameters①">Structured Fields Parameters</a>.</p>
      <li data-md>
       <p>Set <var>paddedEntryParameters</var>["<code>p</code>"] to a <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc8941.html#name-tokens" id="ref-for-name-tokens①">Structured Fields Token</a> with value <var>paddedToken</var>.</p>
      <li data-md>
       <p>Let <var>emptyInnerList</var> be an empty <a href="https://www.rfc-editor.org/rfc/rfc8941.html#name-inner-lists">Structured Fields Inner List</a>.</p>
      <li data-md>
       <p>Associate <var>paddedEntryParameters</var> with <var>emptyInnerList</var>.</p>
      <li data-md>
       <p>Append <var>emptyInnerList</var> to <var>topicsStructuredFieldsList</var>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header" id="ref-for-concept-header-list-set-structured-header">Set a structured field value</a> given (<span>`<code><a data-link-type="http-header" href="#http-headerdef-sec-browsing-topics" id="ref-for-http-headerdef-sec-browsing-topics②">Sec-Browsing-Topics</a></code>`</span>, <var>topicsStructuredFieldsList</var>) in <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list①">header list</a>.</p>
     </ol>
     <div class="note" role="note">
       This algorithm transforms the topics list into structured fields format, which contains paddings to make the total length consistent for different topics callers. 
      <div class="example" id="example-4fa12bf3">
       <a class="self-link" href="#example-4fa12bf3"></a> Empty returned topics, and underlying epochs have same versions: 
       <p><code>();p=P0000000000000000000000000000000</code></p>
      </div>
      <div class="example" id="example-c8b11203">
       <a class="self-link" href="#example-c8b11203"></a> One returned topic, and underlying epochs have same versions: 
       <p><code>(1);v=chrome.1:1:2, ();p=P00000000000</code></p>
      </div>
      <div class="example" id="example-06c90a39">
       <a class="self-link" href="#example-06c90a39"></a> Two returned topics, and underlying epochs have same versions: 
       <p><code>(1 2);v=chrome.1:1:2, ();p=P000000000</code></p>
      </div>
      <div class="example" id="example-bfa8b698">
       <a class="self-link" href="#example-bfa8b698"></a> Two returned topics, and underlying epochs have two different versions: 
       <p><code>(1);v=chrome.1:1:2, (1);v=chrome.1:1:4, ();p=P0000000000</code></p>
      </div>
      <div class="example" id="example-eed5242a">
       <a class="self-link" href="#example-eed5242a"></a> Three returned topics, and underlying epochs have three different versions: 
       <p><code>(100);v=chrome.1:1:20, (200);v=chrome.1:1:40, (300);v=chrome.1:1:60, ();p=P</code></p>
      </div>
      <p>Why adding paddings: servers typically have a GET request size limit e.g. 8KB, and will return an error when the limit is reached. An attacker can rely this to learn the number of topics for a different domain, and/or a small amount of information about the topics themselves (e.g whether the <a data-link-type="dfn" href="#browsing-topics-types-topic-ids" id="ref-for-browsing-topics-types-topic-ids①①">topic ids</a> are &lt; 10, &lt; 100, etc.)</p>
      <p>The various lengths being returned (that depends on the number of distinct versions) could leak which epochs the user had disabled topics or didn’t use the browser, if it coincided with the version change. But this leak is minor. The most common cases (i.e. returning same version topics, or no topics) will have the same length.</p>
     </div>
     <div class="note" role="note"> In Chrome’s experimentation phase, it will additionally require a valid <a href="https://github.com/GoogleChrome/OriginTrials/blob/gh-pages/explainer.md">Origin Trial</a> token to exist in <var>initiatorWindow</var>’s <a data-cite="!HTML#concept-document-window" data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window" id="ref-for-concept-document-window">associated document</a> for the request to be eligible for topics. </div>
    </div>
    <h3 class="heading settled" data-level="15.9" id="the-observe-browsing-topics-http-response-header-header"><span class="secno">15.9. </span><span class="content">The `<code>Observe-Browsing-Topics</code>` HTTP response header</span><a class="self-link" href="#the-observe-browsing-topics-http-response-header-header"></a></h3>
    <p>The `<dfn class="dfn-paneled" data-dfn-type="http-header" data-export id="http-headerdef-observe-browsing-topics"><code>Observe-Browsing-Topics</code></dfn>` HTTP response header can be used to record a caller’s topics observation.</p>
    <div class="algorithm" data-algorithm="handle topics response">
      To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-topics-response">handle topics response</dfn>, given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response">response</a> <var>response</var> and a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> request: 
     <ol>
      <li data-md>
       <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list②">header list</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contain</a> <span>`<code><a data-link-type="http-header" href="#http-headerdef-sec-browsing-topics" id="ref-for-http-headerdef-sec-browsing-topics③">Sec-Browsing-Topics</a></code>`</span> (implying the <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url">current URL</a> is not eligible for topics), then return.</p>
      <li data-md>
       <p>Let <var>topLevelDocument</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-window" id="ref-for-concept-request-window①">window</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global①">global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable" id="ref-for-window-navigable①">navigable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top②">top-level traversable</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document②">active document</a>.</p>
      <li data-md>
       <p>Let <var>callerDomain</var> be <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url①">current URL</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host④">host</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑨">registrable domain</a>.</p>
      <li data-md>
       <p>Let <var>list</var> be <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a>.</p>
      <li data-md>
       <p>Let <var>observe</var> be the result of running <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header" id="ref-for-concept-header-list-get-structured-header">get a structured field value</a> algorithm given <span>`<code><a data-link-type="http-header" href="#http-headerdef-observe-browsing-topics" id="ref-for-http-headerdef-observe-browsing-topics">Observe-Browsing-Topics</a></code>`</span>, "item", and <var>list</var> as input.</p>
      <li data-md>
       <p>If <var>observe</var> is true:</p>
       <ol>
        <li data-md>
         <p>Run the <a data-link-type="dfn" href="#collect-page-topics-calculation-input-data" id="ref-for-collect-page-topics-calculation-input-data①">collect page topics calculation input data</a> algorithm with <var>topLevelDocument</var> as input.</p>
        <li data-md>
         <p>Run the <a data-link-type="dfn" href="#collect-topics-caller-domain" id="ref-for-collect-topics-caller-domain①">collect topics caller domain</a> algorithm with <var>topLevelDocument</var> and <var>callerDomain</var> as input.</p>
       </ol>
     </ol>
    </div>
    <h3 class="heading settled" data-level="15.10" id="modification-to-http-fetch-steps-header"><span class="secno">15.10. </span><span class="content">Modification to HTTP fetch steps</span><a class="self-link" href="#modification-to-http-fetch-steps-header"></a></h3>
     The following step will be added to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-fetch" id="ref-for-concept-http-fetch">HTTP fetch</a> steps, before checking the redirect status (i.e. "If <var>actualResponse</var>’s status is a redirect status, ..."): 
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-topics-response" id="ref-for-handle-topics-response">Handle topics response</a>, given <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-response" id="ref-for-concept-response-response①">response</a> <var>actualResponse</var> and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request③">request</a> <var>request</var> as input.</p>
    </ol>
    <p><span class="XXX">TODO: make the modification directly to the fetch spec.</span></p>
   </section>
   <section>
    <h2 class="heading settled" data-level="16" id="permissions-policy-integration-header"><span class="secno">16. </span><span class="content">Permissions policy integration</span><a class="self-link" href="#permissions-policy-integration-header"></a></h2>
    <p>This specification defines a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature">policy-controlled feature</a> identified by the string
  "<code><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="browsing-topics-policy-controlled-feature">browsing-topics</dfn></code>". Its <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist">default allowlist</a> is <code>*</code>. </p>
    <p>For backward compatibility, this specification also defines a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature" id="ref-for-policy-controlled-feature①">policy-controlled feature</a> identified by the string
  "<code><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="interest-cohort-policy-controlled-feature">interest-cohort</dfn></code>". Its <a data-link-type="dfn" href="https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist" id="ref-for-policy-controlled-feature-default-allowlist①">default allowlist</a> is <code>*</code>. </p>
   </section>
   <section>
    <h2 class="heading settled" data-level="17" id="privacy-considerations-header"><span class="secno">17. </span><span class="content">Privacy considerations</span><a class="self-link" href="#privacy-considerations-header"></a></h2>
    <p>The Topics API attempts to provide just enough relevant interest information for advertisers to be able to personalize their ads for the user while maintaining user privacy. Some privacy safeguards include: usage in secure contexts only, topic limitation to a human curated taxonomy, different topics given to different sites in the same epoch to prevent cross-site reidentification, noised topics, a limited number of topics provided per epoch, user opt outs, site opt outs, and a suggestion that user agents provide UX to give users choice in which Topics are returned.</p>
   </section>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#append-or-modify-a-request-sec-browsing-topics-header">append or modify a request `Sec-Browsing-Topics` header</a><span>, in § 15.8</span>
   <li><a href="#dictdef-browsingtopic">BrowsingTopic</a><span>, in § 4</span>
   <li><a href="#browsing-topics-policy-controlled-feature">browsing-topics</a><span>, in § 16</span>
   <li>
    browsingTopics
    <ul>
     <li><a href="#dom-htmliframeelement-browsingtopics">attribute for HTMLIFrameElement</a><span>, in § 15.2</span>
     <li><a href="#dom-requestinit-browsingtopics">dict-member for RequestInit</a><span>, in § 15.3</span>
    </ul>
   <li><a href="#element-attrdef-iframe-browsingtopics">browsingtopics</a><span>, in § 15.2</span>
   <li><a href="#dom-document-browsingtopics">browsingTopics()</a><span>, in § 14</span>
   <li><a href="#dom-document-browsingtopics">browsingTopics(options)</a><span>, in § 14</span>
   <li><a href="#dictdef-browsingtopicsoptions">BrowsingTopicsOptions</a><span>, in § 14</span>
   <li><a href="#browsing-topics-task-source">browsing topics task source</a><span>, in § 14</span>
   <li><a href="#calculate-the-epochs-for-caller">calculate the epochs for caller</a><span>, in § 11</span>
   <li><a href="#calculate-the-topics-for-caller">calculate the topics for caller</a><span>, in § 13</span>
   <li><a href="#calculate-user-topics">calculate user topics</a><span>, in § 10</span>
   <li><a href="#topics-caller-context-caller-domain">caller domain</a><span>, in § 2</span>
   <li><a href="#topic-with-caller-domains-caller-domains">caller domains</a><span>, in § 2</span>
   <li><a href="#classify">classify</a><span>, in § 2</span>
   <li><a href="#browsing-topics-dictionary-less-than-comparator">code unit less than</a><span>, in § 4</span>
   <li><a href="#collect-page-topics-calculation-input-data">collect page topics calculation input data</a><span>, in § 7</span>
   <li><a href="#collect-topics-caller-domain">collect topics caller domain</a><span>, in § 8</span>
   <li>
    configuration version
    <ul>
     <li><a href="#browsing-topics-types-configuration-version">dfn for browsing topics types</a><span>, in § 2</span>
     <li><a href="#user-agent-configuration-version">dfn for user agent</a><span>, in § 3</span>
    </ul>
   <li><a href="#epoch-config-version">config version</a><span>, in § 2</span>
   <li><a href="#dom-browsingtopic-configversion">configVersion</a><span>, in § 4</span>
   <li><a href="#derive-top-5-topics">derive top 5 topics</a><span>, in § 9</span>
   <li>
    document id
    <ul>
     <li><a href="#document-id-header-document-id">dfn for document-id-header</a><span>, in § 5</span>
     <li><a href="#topics-history-entry-document-id">dfn for topics history entry</a><span>, in § 2</span>
    </ul>
   <li><a href="#browsing-topics-types-epoch">epoch</a><span>, in § 2</span>
   <li><a href="#user-topics-state-epochs">epochs</a><span>, in § 2</span>
   <li><a href="#get-descendant-topics">get descendant topics</a><span>, in § 2</span>
   <li><a href="#get-the-number-of-distinct-versions-in-epochs">get the number of distinct versions in epochs</a><span>, in § 12</span>
   <li><a href="#handle-topics-response">handle topics response</a><span>, in § 15.9</span>
   <li><a href="#user-topics-state-hmac-key">hmac key</a><span>, in § 2</span>
   <li><a href="#interest-cohort-policy-controlled-feature">interest-cohort</a><span>, in § 16</span>
   <li><a href="#browsing-topics-types-maximum-version-string-length">maximum version string length</a><span>, in § 2</span>
   <li>
    model
    <ul>
     <li><a href="#browsing-topics-types-model">dfn for browsing topics types</a><span>, in § 2</span>
     <li><a href="#user-agent-model">dfn for user agent</a><span>, in § 3</span>
    </ul>
   <li>
    model version
    <ul>
     <li><a href="#browsing-topics-types-model-version">dfn for browsing topics types</a><span>, in § 2</span>
     <li><a href="#epoch-model-version">dfn for epoch</a><span>, in § 2</span>
     <li><a href="#user-agent-model-version">dfn for user agent</a><span>, in § 3</span>
    </ul>
   <li><a href="#dom-browsingtopic-modelversion">modelVersion</a><span>, in § 4</span>
   <li><a href="#http-headerdef-observe-browsing-topics">Observe-Browsing-Topics</a><span>, in § 15.9</span>
   <li><a href="#schedule-user-topics-calculation">schedule user topics calculation</a><span>, in § 10</span>
   <li><a href="#http-headerdef-sec-browsing-topics">Sec-Browsing-Topics</a><span>, in § 15.6</span>
   <li><a href="#request-send-browsing-topics-header-boolean">send browsing topics header boolean</a><span>, in § 15.1</span>
   <li><a href="#dom-browsingtopicsoptions-skipobservation">skipObservation</a><span>, in § 14</span>
   <li>
    taxonomy
    <ul>
     <li><a href="#browsing-topics-types-taxonomy">dfn for browsing topics types</a><span>, in § 2</span>
     <li><a href="#epoch-taxonomy">dfn for epoch</a><span>, in § 2</span>
     <li><a href="#user-agent-taxonomy">dfn for user agent</a><span>, in § 3</span>
    </ul>
   <li>
    taxonomy version
    <ul>
     <li><a href="#browsing-topics-types-taxonomy-version">dfn for browsing topics types</a><span>, in § 2</span>
     <li><a href="#epoch-taxonomy-version">dfn for epoch</a><span>, in § 2</span>
     <li><a href="#user-agent-taxonomy-version">dfn for user agent</a><span>, in § 3</span>
    </ul>
   <li><a href="#dom-browsingtopic-taxonomyversion">taxonomyVersion</a><span>, in § 4</span>
   <li>
    time
    <ul>
     <li><a href="#epoch-time">dfn for epoch</a><span>, in § 2</span>
     <li><a href="#topics-history-entry-time">dfn for topics history entry</a><span>, in § 2</span>
    </ul>
   <li><a href="#topics-caller-context-timestamp">timestamp</a><span>, in § 2</span>
   <li><a href="#epoch-top-5-topics-with-caller-domains">top 5 topics with caller domains</a><span>, in § 2</span>
   <li><a href="#dom-browsingtopic-topic">topic</a><span>, in § 4</span>
   <li><a href="#topic-with-caller-domains-topic-id">topic id</a><span>, in § 2</span>
   <li><a href="#browsing-topics-types-topic-ids">topic ids</a><span>, in § 2</span>
   <li>
    topics calculation input data
    <ul>
     <li><a href="#determine-topics-calculation-input-data-header-topics-calculation-input-data">dfn for determine-topics-calculation-input-data-header</a><span>, in § 6</span>
     <li><a href="#topics-history-entry-topics-calculation-input-data">dfn for topics history entry</a><span>, in § 2</span>
    </ul>
   <li><a href="#browsing-topics-types-topics-caller-context">topics caller context</a><span>, in § 2</span>
   <li><a href="#topics-history-entry-topics-caller-domains">topics caller domains</a><span>, in § 2</span>
   <li><a href="#browsing-topics-types-topics-history-entry">topics history entry</a><span>, in § 2</span>
   <li><a href="#user-agent-topics-history-storage">topics history storage</a><span>, in § 3</span>
   <li><a href="#browsing-topics-types-topic-with-caller-domains">topic with caller domains</a><span>, in § 2</span>
   <li><a href="#topics-caller-context-top-level-context-domain">top level context domain</a><span>, in § 2</span>
   <li>
    user topics state
    <ul>
     <li><a href="#browsing-topics-types-user-topics-state">dfn for browsing topics types</a><span>, in § 2</span>
     <li><a href="#user-agent-user-topics-state">dfn for user agent</a><span>, in § 3</span>
    </ul>
   <li>
    version
    <ul>
     <li><a href="#browsing-topics-types-version">dfn for browsing topics types</a><span>, in § 2</span>
     <li><a href="#dom-browsingtopic-version">dict-member for BrowsingTopic</a><span>, in § 4</span>
    </ul>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="85394472">Document</span>
     <li><span class="dfn-paneled" id="c62cd7cf">origin</span>
     <li><span class="dfn-paneled" id="347e8fe9">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0dcd4ad9">RequestInit</span>
     <li><span class="dfn-paneled" id="3f2ca4de">current url</span>
     <li><span class="dfn-paneled" id="ee95ecc7">delete</span>
     <li><span class="dfn-paneled" id="2ce6f6bb">fetch(input)</span>
     <li><span class="dfn-paneled" id="5c66de35">get a structured field value</span>
     <li><span class="dfn-paneled" id="d85a6c84">header list</span>
     <li><span class="dfn-paneled" id="6ee0eab1">header list <small>(for request)</small></span>
     <li><span class="dfn-paneled" id="f7b00a8b">header list <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="2aaa2f42">http fetch</span>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
     <li><span class="dfn-paneled" id="162d2b51">request <small>(for Request)</small></span>
     <li><span class="dfn-paneled" id="e3201629">response</span>
     <li><span class="dfn-paneled" id="35b98f13">set a structured field value</span>
     <li><span class="dfn-paneled" id="dc1cd39b">url</span>
     <li><span class="dfn-paneled" id="1ab127d6">window</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HR-TIME-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0e9f636b">DOMHighResTimeStamp</span>
     <li><span class="dfn-paneled" id="80bf04ff">coarsen time</span>
     <li><span class="dfn-paneled" id="4b2c8c72">duration</span>
     <li><span class="dfn-paneled" id="c9a0df83">duration from</span>
     <li><span class="dfn-paneled" id="be5dbc8c">unix epoch</span>
     <li><span class="dfn-paneled" id="12938d07">unsafe current time</span>
     <li><span class="dfn-paneled" id="05de5ae3">wall clock</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="402ed79d">CEReactions</span>
     <li><span class="dfn-paneled" id="10e25f42">HTMLIFrameElement</span>
     <li><span class="dfn-paneled" id="35972864">active document</span>
     <li><span class="dfn-paneled" id="3610bd67">allowed to use</span>
     <li><span class="dfn-paneled" id="3349d69f">associated document</span>
     <li><span class="dfn-paneled" id="762210c0">container</span>
     <li><span class="dfn-paneled" id="68675e70">content attributes</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="8a30477b">global object</span>
     <li><span class="dfn-paneled" id="a354395f">hmac algorithm</span>
     <li><span class="dfn-paneled" id="77a2ee6e">host</span>
     <li><span class="dfn-paneled" id="87fcd40c">iframe</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="228be966">navigable</span>
     <li><span class="dfn-paneled" id="13dd6cae">node navigable</span>
     <li><span class="dfn-paneled" id="b01b1359">opaque origin</span>
     <li><span class="dfn-paneled" id="a59b13b1">post-prerendering activation steps list</span>
     <li><span class="dfn-paneled" id="15012e89">prerendering navigable</span>
     <li><span class="dfn-paneled" id="48438eb3">queue a global task</span>
     <li><span class="dfn-paneled" id="5ab7b520">reflect</span>
     <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
     <li><span class="dfn-paneled" id="65181da8">secure context</span>
     <li><span class="dfn-paneled" id="5bea5516">structured fields parameters</span>
     <li><span class="dfn-paneled" id="b5e4ce8a">structured fields token</span>
     <li><span class="dfn-paneled" id="30717154">top-level traversable</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53275e46">append <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="a3b18719">append <small>(for set)</small></span>
     <li><span class="dfn-paneled" id="4135591f">code unit less than</span>
     <li><span class="dfn-paneled" id="4a3bf5fb">concatenate</span>
     <li><span class="dfn-paneled" id="ae8def21">contain</span>
     <li><span class="dfn-paneled" id="1243a891">exist</span>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
     <li><span class="dfn-paneled" id="31db57e6">keys</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="84b454ff">ordered map</span>
     <li><span class="dfn-paneled" id="0204d188">size</span>
     <li><span class="dfn-paneled" id="6d19ac93">user agent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS-POLICY-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1570624a">default allowlist</span>
     <li><span class="dfn-paneled" id="cc890cc1">policy-controlled feature</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SECURE-CONTEXTS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="96dabee7">potentially trustworthy origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b85ee3be">host</span>
     <li><span class="dfn-paneled" id="959ad97b">origin</span>
     <li><span class="dfn-paneled" id="bc9d7803">registrable domain</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="c01cbda0">EnforceRange</span>
     <li><span class="dfn-paneled" id="ba556545">NotAllowedError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="dacde8b5">a new promise</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="b262501e">reject</span>
     <li><span class="dfn-paneled" id="3b90bdcd">resolve</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-hr-time-3">[HR-TIME-3]
   <dd>Yoav Weiss. <a href="https://w3c.github.io/hr-time/"><cite>High Resolution Time</cite></a>. URL: <a href="https://w3c.github.io/hr-time/">https://w3c.github.io/hr-time/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-permissions-policy-1">[PERMISSIONS-POLICY-1]
   <dd>Ian Clelland. <a href="https://w3c.github.io/webappsec-permissions-policy/"><cite>Permissions Policy</cite></a>. URL: <a href="https://w3c.github.io/webappsec-permissions-policy/">https://w3c.github.io/webappsec-permissions-policy/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-secure-contexts">[SECURE-CONTEXTS]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-secure-contexts/"><cite>Secure Contexts</cite></a>. URL: <a href="https://w3c.github.io/webappsec-secure-contexts/">https://w3c.github.io/webappsec-secure-contexts/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>dictionary</c-> <a href="#dictdef-browsingtopic"><code><c- g>BrowsingTopic</c-></code></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-type="unsigned long long " href="#dom-browsingtopic-topic"><code><c- g>topic</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-browsingtopic-version"><code><c- g>version</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-browsingtopic-configversion"><code><c- g>configVersion</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-browsingtopic-modelversion"><code><c- g>modelVersion</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-browsingtopic-taxonomyversion"><code><c- g>taxonomyVersion</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-browsingtopicsoptions"><code><c- g>BrowsingTopicsOptions</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-browsingtopicsoptions-skipobservation"><code><c- g>skipObservation</c-></code></a> = <c- b>false</c->;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#document"><c- g>Document</c-></a> {
    [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-browsingtopic"><c- n>BrowsingTopic</c-></a>>> <a class="idl-code" data-link-type="method" href="#dom-document-browsingtopics"><c- g>browsingTopics</c-></a>(<c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-browsingtopicsoptions"><c- n>BrowsingTopicsOptions</c-></a> <a href="#dom-document-browsingtopics-options-options"><code><c- g>options</c-></code></a> = {});
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement"><c- g>HTMLIFrameElement</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions"><c- g>CEReactions</c-></a>] <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-type="boolean" href="#dom-htmliframeelement-browsingtopics"><c- g>browsingTopics</c-></a>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://fetch.spec.whatwg.org/#requestinit"><c- g>RequestInit</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-type="boolean " href="#dom-requestinit-browsingtopics"><code><c- g>browsingTopics</c-></code></a>;
};

</pre>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['85394472'] = {"dfnID": "85394472", "url": "https://dom.spec.whatwg.org/#document", "dfnText": "Document", "refSections": [{"refs": [{"id": "ref-for-document"}, {"id": "ref-for-document\u2460"}], "title": "5. document ID"}, {"refs": [{"id": "ref-for-document\u2461"}, {"id": "ref-for-document\u2462"}], "title": "6. Determine topics calculation input data"}, {"refs": [{"id": "ref-for-document\u2463"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-document\u2464"}], "title": "8. Collect topics caller domain"}, {"refs": [{"id": "ref-for-document\u2465"}, {"id": "ref-for-document\u2466"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['c62cd7cf'] = {"dfnID": "c62cd7cf", "url": "https://dom.spec.whatwg.org/#concept-document-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-document-origin"}, {"id": "ref-for-concept-document-origin\u2460"}, {"id": "ref-for-concept-document-origin\u2461"}, {"id": "ref-for-concept-document-origin\u2462"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-concept-document-origin\u2463"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['347e8fe9'] = {"dfnID": "347e8fe9", "url": "https://dom.spec.whatwg.org/#concept-document-url", "dfnText": "url", "refSections": [{"refs": [{"id": "ref-for-concept-document-url"}, {"id": "ref-for-concept-document-url\u2460"}], "title": "6. Determine topics calculation input data"}], "external": true};
window.dfnpanelData['0dcd4ad9'] = {"dfnID": "0dcd4ad9", "url": "https://fetch.spec.whatwg.org/#requestinit", "dfnText": "RequestInit", "refSections": [{"refs": [{"id": "177d70c80"}, {"id": "ref-for-requestinit"}], "title": "15.3. browsingTopics attribute in RequestInit"}], "external": true};
window.dfnpanelData['3f2ca4de'] = {"dfnID": "3f2ca4de", "url": "https://fetch.spec.whatwg.org/#concept-request-current-url", "dfnText": "current url", "refSections": [{"refs": [{"id": "ref-for-concept-request-current-url"}, {"id": "ref-for-concept-request-current-url\u2460"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['ee95ecc7'] = {"dfnID": "ee95ecc7", "url": "https://fetch.spec.whatwg.org/#concept-header-list-delete", "dfnText": "delete", "refSections": [{"refs": [{"id": "ref-for-concept-header-list-delete"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['2ce6f6bb'] = {"dfnID": "2ce6f6bb", "url": "https://fetch.spec.whatwg.org/#dom-global-fetch", "dfnText": "fetch(input)", "refSections": [{"refs": [{"id": "ref-for-dom-global-fetch"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-dom-global-fetch\u2460"}], "title": "15. fetch() and iframe integration"}], "external": true};
window.dfnpanelData['5c66de35'] = {"dfnID": "5c66de35", "url": "https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header", "dfnText": "get a structured field value", "refSections": [{"refs": [{"id": "ref-for-concept-header-list-get-structured-header"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['d85a6c84'] = {"dfnID": "d85a6c84", "url": "https://fetch.spec.whatwg.org/#concept-header-list", "dfnText": "header list", "refSections": [{"refs": [{"id": "ref-for-concept-header-list"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['6ee0eab1'] = {"dfnID": "6ee0eab1", "url": "https://fetch.spec.whatwg.org/#concept-request-header-list", "dfnText": "header list (for request)", "refSections": [{"refs": [{"id": "ref-for-concept-request-header-list"}], "title": "15.7. Modification to HTTP-network-or-cache fetch algorithm"}, {"refs": [{"id": "ref-for-concept-request-header-list\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-concept-request-header-list\u2461"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['f7b00a8b'] = {"dfnID": "f7b00a8b", "url": "https://fetch.spec.whatwg.org/#concept-response-header-list", "dfnText": "header list (for response)", "refSections": [{"refs": [{"id": "ref-for-concept-response-header-list"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['2aaa2f42'] = {"dfnID": "2aaa2f42", "url": "https://fetch.spec.whatwg.org/#concept-http-fetch", "dfnText": "http fetch", "refSections": [{"refs": [{"id": "ref-for-concept-http-fetch"}], "title": "15.10. Modification to HTTP fetch steps"}], "external": true};
window.dfnpanelData['55213b5b'] = {"dfnID": "55213b5b", "url": "https://fetch.spec.whatwg.org/#concept-request", "dfnText": "request", "refSections": [{"refs": [{"id": "ref-for-concept-request"}], "title": "15.1. send browsing topics header boolean associated with Request"}, {"refs": [{"id": "ref-for-concept-request\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-concept-request\u2461"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}, {"refs": [{"id": "ref-for-concept-request\u2462"}], "title": "15.10. Modification to HTTP fetch steps"}], "external": true};
window.dfnpanelData['162d2b51'] = {"dfnID": "162d2b51", "url": "https://fetch.spec.whatwg.org/#concept-request-request", "dfnText": "request (for Request)", "refSections": [{"refs": [{"id": "ref-for-concept-request-request"}], "title": "15.4. Modification to request constructor steps"}, {"refs": [{"id": "ref-for-concept-request-request\u2460"}], "title": "15.5. Modification to \"create navigation params by fetching\" steps"}], "external": true};
window.dfnpanelData['e3201629'] = {"dfnID": "e3201629", "url": "https://fetch.spec.whatwg.org/#concept-response-response", "dfnText": "response", "refSections": [{"refs": [{"id": "ref-for-concept-response-response"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}, {"refs": [{"id": "ref-for-concept-response-response\u2460"}], "title": "15.10. Modification to HTTP fetch steps"}], "external": true};
window.dfnpanelData['35b98f13'] = {"dfnID": "35b98f13", "url": "https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header", "dfnText": "set a structured field value", "refSections": [{"refs": [{"id": "ref-for-concept-header-list-set-structured-header"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['dc1cd39b'] = {"dfnID": "dc1cd39b", "url": "https://fetch.spec.whatwg.org/#concept-request-url", "dfnText": "url", "refSections": [{"refs": [{"id": "ref-for-concept-request-url"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['1ab127d6'] = {"dfnID": "1ab127d6", "url": "https://fetch.spec.whatwg.org/#concept-request-window", "dfnText": "window", "refSections": [{"refs": [{"id": "ref-for-concept-request-window"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-concept-request-window\u2460"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['0e9f636b'] = {"dfnID": "0e9f636b", "url": "https://w3c.github.io/hr-time/#dom-domhighrestimestamp", "dfnText": "DOMHighResTimeStamp", "refSections": [{"refs": [{"id": "ref-for-dom-domhighrestimestamp"}, {"id": "ref-for-dom-domhighrestimestamp\u2460"}, {"id": "ref-for-dom-domhighrestimestamp\u2461"}], "title": "2. Terminology and types"}], "external": true};
window.dfnpanelData['80bf04ff'] = {"dfnID": "80bf04ff", "url": "https://w3c.github.io/hr-time/#dfn-coarsen-time", "dfnText": "coarsen time", "refSections": [{"refs": [{"id": "ref-for-dfn-coarsen-time"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-dfn-coarsen-time\u2460"}, {"id": "ref-for-dfn-coarsen-time\u2461"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-dfn-coarsen-time\u2462"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-dfn-coarsen-time\u2463"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['4b2c8c72'] = {"dfnID": "4b2c8c72", "url": "https://w3c.github.io/hr-time/#dfn-duration", "dfnText": "duration", "refSections": [{"refs": [{"id": "ref-for-dfn-duration"}, {"id": "ref-for-dfn-duration\u2460"}, {"id": "ref-for-dfn-duration\u2461"}, {"id": "ref-for-dfn-duration\u2462"}, {"id": "ref-for-dfn-duration\u2463"}, {"id": "ref-for-dfn-duration\u2464"}, {"id": "ref-for-dfn-duration\u2465"}, {"id": "ref-for-dfn-duration\u2466"}, {"id": "ref-for-dfn-duration\u2467"}, {"id": "ref-for-dfn-duration\u2468"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-dfn-duration\u2460\u24ea"}], "title": "11. Epochs for caller"}], "external": true};
window.dfnpanelData['c9a0df83'] = {"dfnID": "c9a0df83", "url": "https://w3c.github.io/hr-time/#dfn-duration-from", "dfnText": "duration from", "refSections": [{"refs": [{"id": "ref-for-dfn-duration-from"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-dfn-duration-from\u2460"}, {"id": "ref-for-dfn-duration-from\u2461"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-dfn-duration-from\u2462"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-dfn-duration-from\u2463"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['be5dbc8c'] = {"dfnID": "be5dbc8c", "url": "https://w3c.github.io/hr-time/#dfn-unix-epoch", "dfnText": "unix epoch", "refSections": [{"refs": [{"id": "ref-for-dfn-unix-epoch"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-dfn-unix-epoch\u2460"}, {"id": "ref-for-dfn-unix-epoch\u2461"}, {"id": "ref-for-dfn-unix-epoch\u2462"}, {"id": "ref-for-dfn-unix-epoch\u2463"}, {"id": "ref-for-dfn-unix-epoch\u2464"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-dfn-unix-epoch\u2465"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-dfn-unix-epoch\u2466"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['12938d07'] = {"dfnID": "12938d07", "url": "https://w3c.github.io/hr-time/#wall-clock-unsafe-current-time", "dfnText": "unsafe current time", "refSections": [{"refs": [{"id": "ref-for-wall-clock-unsafe-current-time"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-wall-clock-unsafe-current-time\u2460"}, {"id": "ref-for-wall-clock-unsafe-current-time\u2461"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-wall-clock-unsafe-current-time\u2462"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-wall-clock-unsafe-current-time\u2463"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['05de5ae3'] = {"dfnID": "05de5ae3", "url": "https://w3c.github.io/hr-time/#dfn-wall-clock", "dfnText": "wall clock", "refSections": [{"refs": [{"id": "ref-for-dfn-wall-clock"}, {"id": "ref-for-dfn-wall-clock\u2460"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-dfn-wall-clock\u2461"}, {"id": "ref-for-dfn-wall-clock\u2462"}, {"id": "ref-for-dfn-wall-clock\u2463"}, {"id": "ref-for-dfn-wall-clock\u2464"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-dfn-wall-clock\u2465"}, {"id": "ref-for-dfn-wall-clock\u2466"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-dfn-wall-clock\u2467"}, {"id": "ref-for-dfn-wall-clock\u2468"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['402ed79d'] = {"dfnID": "402ed79d", "url": "https://html.spec.whatwg.org/multipage/custom-elements.html#cereactions", "dfnText": "CEReactions", "refSections": [{"refs": [{"id": "ref-for-cereactions"}], "title": "15.2. browsingtopics content attribute for HTMLIframeElement"}], "external": true};
window.dfnpanelData['10e25f42'] = {"dfnID": "10e25f42", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement", "dfnText": "HTMLIFrameElement", "refSections": [{"refs": [{"id": "ref-for-htmliframeelement"}], "title": "15.2. browsingtopics content attribute for HTMLIframeElement"}], "external": true};
window.dfnpanelData['35972864'] = {"dfnID": "35972864", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document", "dfnText": "active document", "refSections": [{"refs": [{"id": "ref-for-nav-document"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-nav-document\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-nav-document\u2461"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['3610bd67'] = {"dfnID": "3610bd67", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use", "dfnText": "allowed to use", "refSections": [{"refs": [{"id": "ref-for-allowed-to-use"}, {"id": "ref-for-allowed-to-use\u2460"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['3349d69f'] = {"dfnID": "3349d69f", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window", "dfnText": "associated document", "refSections": [{"refs": [{"id": "ref-for-concept-document-window"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['762210c0'] = {"dfnID": "762210c0", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-container", "dfnText": "container", "refSections": [{"refs": [{"id": "ref-for-nav-container"}], "title": "15.5. Modification to \"create navigation params by fetching\" steps"}], "external": true};
window.dfnpanelData['68675e70'] = {"dfnID": "68675e70", "url": "https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes", "dfnText": "content attributes", "refSections": [{"refs": [{"id": "ref-for-concept-element-attributes"}, {"id": "ref-for-concept-element-attributes\u2460"}], "title": "15.2. browsingtopics content attribute for HTMLIframeElement"}, {"refs": [{"id": "ref-for-concept-element-attributes\u2461"}], "title": "15.5. Modification to \"create navigation params by fetching\" steps"}], "external": true};
window.dfnpanelData['3e12e042'] = {"dfnID": "3e12e042", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object", "dfnText": "environment settings object", "refSections": [{"refs": [{"id": "ref-for-environment-settings-object"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['8a30477b'] = {"dfnID": "8a30477b", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global", "dfnText": "global object", "refSections": [{"refs": [{"id": "ref-for-concept-settings-object-global"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-concept-settings-object-global\u2460"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['a354395f'] = {"dfnID": "a354395f", "url": "https://www.rfc-editor.org/rfc/rfc6234#section-8.3", "dfnText": "hmac algorithm", "refSections": [{"refs": [{"id": "ref-for-section-8.3"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-section-8.3\u2460"}, {"id": "ref-for-section-8.3\u2461"}, {"id": "ref-for-section-8.3\u2462"}], "title": "13. Topics for caller"}], "external": true};
window.dfnpanelData['77a2ee6e'] = {"dfnID": "77a2ee6e", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host", "dfnText": "host", "refSections": [{"refs": [{"id": "ref-for-concept-origin-host"}, {"id": "ref-for-concept-origin-host\u2460"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-concept-origin-host\u2461"}, {"id": "ref-for-concept-origin-host\u2462"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-concept-origin-host\u2463"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['87fcd40c'] = {"dfnID": "87fcd40c", "url": "https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element", "dfnText": "iframe", "refSections": [{"refs": [{"id": "63353a1a0"}], "title": "15.2. browsingtopics content attribute for HTMLIframeElement"}, {"refs": [{"id": "ref-for-the-iframe-element"}], "title": "15.5. Modification to \"create navigation params by fetching\" steps"}], "external": true};
window.dfnpanelData['a72449dd'] = {"dfnID": "a72449dd", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel", "dfnText": "in parallel", "refSections": [{"refs": [{"id": "ref-for-in-parallel"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-in-parallel\u2460"}], "title": "8. Collect topics caller domain"}, {"refs": [{"id": "ref-for-in-parallel\u2461"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['228be966'] = {"dfnID": "228be966", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable", "dfnText": "navigable", "refSections": [{"refs": [{"id": "ref-for-window-navigable"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-window-navigable\u2460"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['13dd6cae'] = {"dfnID": "13dd6cae", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable", "dfnText": "node navigable", "refSections": [{"refs": [{"id": "ref-for-node-navigable"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-node-navigable\u2460"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['b01b1359'] = {"dfnID": "b01b1359", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque", "dfnText": "opaque origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin-opaque"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['a59b13b1'] = {"dfnID": "a59b13b1", "url": "https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list", "dfnText": "post-prerendering activation steps list", "refSections": [{"refs": [{"id": "ref-for-platform-object-post-prerendering-activation-steps-list"}], "title": "7. Collect page topics calculation input data"}], "external": true};
window.dfnpanelData['15012e89'] = {"dfnID": "15012e89", "url": "https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable", "dfnText": "prerendering navigable", "refSections": [{"refs": [{"id": "ref-for-prerendering-navigable"}], "title": "7. Collect page topics calculation input data"}], "external": true};
window.dfnpanelData['48438eb3'] = {"dfnID": "48438eb3", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task", "dfnText": "queue a global task", "refSections": [{"refs": [{"id": "ref-for-queue-a-global-task"}, {"id": "ref-for-queue-a-global-task\u2460"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['5ab7b520'] = {"dfnID": "5ab7b520", "url": "https://html.spec.whatwg.org/multipage/common-dom-interfaces.html#reflect", "dfnText": "reflect", "refSections": [{"refs": [{"id": "ref-for-reflect"}], "title": "15.2. browsingtopics content attribute for HTMLIframeElement"}], "external": true};
window.dfnpanelData['e99bd18e'] = {"dfnID": "e99bd18e", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global", "dfnText": "relevant global object", "refSections": [{"refs": [{"id": "ref-for-concept-relevant-global"}, {"id": "ref-for-concept-relevant-global\u2460"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['65181da8'] = {"dfnID": "65181da8", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#secure-context", "dfnText": "secure context", "refSections": [{"refs": [{"id": "ref-for-secure-context"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-secure-context\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['5bea5516'] = {"dfnID": "5bea5516", "url": "https://www.rfc-editor.org/rfc/rfc8941.html#name-parameters", "dfnText": "structured fields parameters", "refSections": [{"refs": [{"id": "ref-for-name-parameters"}, {"id": "ref-for-name-parameters\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['b5e4ce8a'] = {"dfnID": "b5e4ce8a", "url": "https://www.rfc-editor.org/rfc/rfc8941.html#name-tokens", "dfnText": "structured fields token", "refSections": [{"refs": [{"id": "ref-for-name-tokens"}, {"id": "ref-for-name-tokens\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['30717154'] = {"dfnID": "30717154", "url": "https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top", "dfnText": "top-level traversable", "refSections": [{"refs": [{"id": "ref-for-nav-top"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-nav-top\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-nav-top\u2461"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['53275e46'] = {"dfnID": "53275e46", "url": "https://infra.spec.whatwg.org/#list-append", "dfnText": "append (for list)", "refSections": [{"refs": [{"id": "ref-for-list-append"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-list-append\u2460"}, {"id": "ref-for-list-append\u2461"}, {"id": "ref-for-list-append\u2462"}, {"id": "ref-for-list-append\u2463"}, {"id": "ref-for-list-append\u2464"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-list-append\u2465"}], "title": "11. Epochs for caller"}], "external": true};
window.dfnpanelData['a3b18719'] = {"dfnID": "a3b18719", "url": "https://infra.spec.whatwg.org/#set-append", "dfnText": "append (for set)", "refSections": [{"refs": [{"id": "ref-for-set-append"}], "title": "8. Collect topics caller domain"}], "external": true};
window.dfnpanelData['4135591f'] = {"dfnID": "4135591f", "url": "https://infra.spec.whatwg.org/#code-unit-less-than", "dfnText": "code unit less than", "refSections": [{"refs": [{"id": "ref-for-code-unit-less-than"}], "title": "4. BrowsingTopic dictionary"}], "external": true};
window.dfnpanelData['4a3bf5fb'] = {"dfnID": "4a3bf5fb", "url": "https://infra.spec.whatwg.org/#string-concatenate", "dfnText": "concatenate", "refSections": [{"refs": [{"id": "ref-for-string-concatenate"}], "title": "2. Terminology and types"}], "external": true};
window.dfnpanelData['ae8def21'] = {"dfnID": "ae8def21", "url": "https://infra.spec.whatwg.org/#list-contain", "dfnText": "contain", "refSections": [{"refs": [{"id": "ref-for-list-contain"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['1243a891'] = {"dfnID": "1243a891", "url": "https://infra.spec.whatwg.org/#map-exists", "dfnText": "exist", "refSections": [{"refs": [{"id": "ref-for-map-exists"}], "title": "15.4. Modification to request constructor steps"}], "external": true};
window.dfnpanelData['860300d4'] = {"dfnID": "860300d4", "url": "https://infra.spec.whatwg.org/#implementation-defined", "dfnText": "implementation-defined", "refSections": [{"refs": [{"id": "ref-for-implementation-defined"}], "title": "5. document ID"}], "external": true};
window.dfnpanelData['31db57e6'] = {"dfnID": "31db57e6", "url": "https://infra.spec.whatwg.org/#map-getting-the-keys", "dfnText": "keys", "refSections": [{"refs": [{"id": "ref-for-map-getting-the-keys"}], "title": "9. Derive top 5 topics"}], "external": true};
window.dfnpanelData['649608b9'] = {"dfnID": "649608b9", "url": "https://infra.spec.whatwg.org/#list", "dfnText": "list", "refSections": [{"refs": [{"id": "ref-for-list"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-list\u2460"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-list\u2461"}, {"id": "ref-for-list\u2462"}, {"id": "ref-for-list\u2463"}], "title": "9. Derive top 5 topics"}, {"refs": [{"id": "ref-for-list\u2464"}, {"id": "ref-for-list\u2465"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-list\u2466"}, {"id": "ref-for-list\u2467"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-list\u2468"}], "title": "13. Topics for caller"}], "external": true};
window.dfnpanelData['84b454ff'] = {"dfnID": "84b454ff", "url": "https://infra.spec.whatwg.org/#ordered-map", "dfnText": "ordered map", "refSections": [{"refs": [{"id": "ref-for-ordered-map"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['0204d188'] = {"dfnID": "0204d188", "url": "https://infra.spec.whatwg.org/#list-size", "dfnText": "size", "refSections": [{"refs": [{"id": "ref-for-list-size"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-list-size\u2460"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-list-size\u2461"}], "title": "12. Get the number of distinct versions in epochs"}, {"refs": [{"id": "ref-for-list-size\u2462"}], "title": "13. Topics for caller"}], "external": true};
window.dfnpanelData['6d19ac93'] = {"dfnID": "6d19ac93", "url": "https://infra.spec.whatwg.org/#user-agent", "dfnText": "user agent", "refSections": [{"refs": [{"id": "ref-for-user-agent"}, {"id": "ref-for-user-agent\u2460"}, {"id": "ref-for-user-agent\u2461"}, {"id": "ref-for-user-agent\u2462"}], "title": "3. User agent associated state"}], "external": true};
window.dfnpanelData['1570624a'] = {"dfnID": "1570624a", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist", "dfnText": "default allowlist", "refSections": [{"refs": [{"id": "ref-for-policy-controlled-feature-default-allowlist"}, {"id": "ref-for-policy-controlled-feature-default-allowlist\u2460"}], "title": "16. Permissions policy integration"}], "external": true};
window.dfnpanelData['cc890cc1'] = {"dfnID": "cc890cc1", "url": "https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature", "dfnText": "policy-controlled feature", "refSections": [{"refs": [{"id": "ref-for-policy-controlled-feature"}, {"id": "ref-for-policy-controlled-feature\u2460"}], "title": "16. Permissions policy integration"}], "external": true};
window.dfnpanelData['96dabee7'] = {"dfnID": "96dabee7", "url": "https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin", "dfnText": "potentially trustworthy origin", "refSections": [{"refs": [{"id": "ref-for-potentially-trustworthy-origin"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": true};
window.dfnpanelData['b85ee3be'] = {"dfnID": "b85ee3be", "url": "https://url.spec.whatwg.org/#concept-url-host", "dfnText": "host", "refSections": [{"refs": [{"id": "ref-for-concept-url-host"}], "title": "6. Determine topics calculation input data"}], "external": true};
window.dfnpanelData['959ad97b'] = {"dfnID": "959ad97b", "url": "https://url.spec.whatwg.org/#concept-url-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-url-origin"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-concept-url-origin\u2460"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['bc9d7803'] = {"dfnID": "bc9d7803", "url": "https://url.spec.whatwg.org/#host-registrable-domain", "dfnText": "registrable domain", "refSections": [{"refs": [{"id": "ref-for-host-registrable-domain"}, {"id": "ref-for-host-registrable-domain\u2460"}, {"id": "ref-for-host-registrable-domain\u2461"}, {"id": "ref-for-host-registrable-domain\u2462"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-host-registrable-domain\u2463"}], "title": "8. Collect topics caller domain"}, {"refs": [{"id": "ref-for-host-registrable-domain\u2464"}, {"id": "ref-for-host-registrable-domain\u2465"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-host-registrable-domain\u2466"}, {"id": "ref-for-host-registrable-domain\u2467"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-host-registrable-domain\u2468"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": true};
window.dfnpanelData['dca2de17'] = {"dfnID": "dca2de17", "url": "https://webidl.spec.whatwg.org/#idl-DOMException", "dfnText": "DOMException", "refSections": [{"refs": [{"id": "ref-for-idl-DOMException"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['8855a9aa'] = {"dfnID": "8855a9aa", "url": "https://webidl.spec.whatwg.org/#idl-DOMString", "dfnText": "DOMString", "refSections": [{"refs": [{"id": "ref-for-idl-DOMString"}, {"id": "ref-for-idl-DOMString\u2460"}, {"id": "ref-for-idl-DOMString\u2461"}, {"id": "ref-for-idl-DOMString\u2462"}], "title": "4. BrowsingTopic dictionary"}], "external": true};
window.dfnpanelData['c01cbda0'] = {"dfnID": "c01cbda0", "url": "https://webidl.spec.whatwg.org/#EnforceRange", "dfnText": "EnforceRange", "refSections": [{"refs": [{"id": "ref-for-EnforceRange"}], "title": "4. BrowsingTopic dictionary"}], "external": true};
window.dfnpanelData['ba556545'] = {"dfnID": "ba556545", "url": "https://webidl.spec.whatwg.org/#notallowederror", "dfnText": "NotAllowedError", "refSections": [{"refs": [{"id": "ref-for-notallowederror"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['bdbd19d1'] = {"dfnID": "bdbd19d1", "url": "https://webidl.spec.whatwg.org/#idl-promise", "dfnText": "Promise", "refSections": [{"refs": [{"id": "ref-for-idl-promise"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['b75bb3bd'] = {"dfnID": "b75bb3bd", "url": "https://webidl.spec.whatwg.org/#SecureContext", "dfnText": "SecureContext", "refSections": [{"refs": [{"id": "ref-for-SecureContext"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['dacde8b5'] = {"dfnID": "dacde8b5", "url": "https://webidl.spec.whatwg.org/#a-new-promise", "dfnText": "a new promise", "refSections": [{"refs": [{"id": "ref-for-a-new-promise"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['5372cca8'] = {"dfnID": "5372cca8", "url": "https://webidl.spec.whatwg.org/#idl-boolean", "dfnText": "boolean", "refSections": [{"refs": [{"id": "ref-for-idl-boolean"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-idl-boolean\u2460"}], "title": "15.2. browsingtopics content attribute for HTMLIframeElement"}, {"refs": [{"id": "ref-for-idl-boolean\u2461"}], "title": "15.3. browsingTopics attribute in RequestInit"}], "external": true};
window.dfnpanelData['b262501e'] = {"dfnID": "b262501e", "url": "https://webidl.spec.whatwg.org/#reject", "dfnText": "reject", "refSections": [{"refs": [{"id": "ref-for-reject"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['3b90bdcd'] = {"dfnID": "3b90bdcd", "url": "https://webidl.spec.whatwg.org/#resolve", "dfnText": "resolve", "refSections": [{"refs": [{"id": "ref-for-resolve"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['9cce47fd'] = {"dfnID": "9cce47fd", "url": "https://webidl.spec.whatwg.org/#idl-sequence", "dfnText": "sequence", "refSections": [{"refs": [{"id": "ref-for-idl-sequence"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['4013a022'] = {"dfnID": "4013a022", "url": "https://webidl.spec.whatwg.org/#this", "dfnText": "this", "refSections": [{"refs": [{"id": "ref-for-this"}], "title": "14. The JavaScript API"}], "external": true};
window.dfnpanelData['f14b47b8'] = {"dfnID": "f14b47b8", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long-long", "dfnText": "unsigned long long", "refSections": [{"refs": [{"id": "ref-for-idl-unsigned-long-long"}], "title": "4. BrowsingTopic dictionary"}], "external": true};
window.dfnpanelData['browsing-topics-types-taxonomy'] = {"dfnID": "browsing-topics-types-taxonomy", "url": "#browsing-topics-types-taxonomy", "dfnText": "taxonomy", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-taxonomy"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-taxonomy\u2460"}], "title": "3. User agent associated state"}], "external": false};
window.dfnpanelData['browsing-topics-types-topic-ids'] = {"dfnID": "browsing-topics-types-topic-ids", "url": "#browsing-topics-types-topic-ids", "dfnText": "topic ids", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-topic-ids"}, {"id": "ref-for-browsing-topics-types-topic-ids\u2460"}, {"id": "ref-for-browsing-topics-types-topic-ids\u2461"}, {"id": "ref-for-browsing-topics-types-topic-ids\u2462"}, {"id": "ref-for-browsing-topics-types-topic-ids\u2463"}, {"id": "ref-for-browsing-topics-types-topic-ids\u2464"}, {"id": "ref-for-browsing-topics-types-topic-ids\u2465"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-topic-ids\u2466"}], "title": "4. BrowsingTopic dictionary"}, {"refs": [{"id": "ref-for-browsing-topics-types-topic-ids\u2467"}], "title": "9. Derive top 5 topics"}, {"refs": [{"id": "ref-for-browsing-topics-types-topic-ids\u2468"}, {"id": "ref-for-browsing-topics-types-topic-ids\u2460\u24ea"}, {"id": "ref-for-browsing-topics-types-topic-ids\u2460\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['browsing-topics-types-taxonomy-version'] = {"dfnID": "browsing-topics-types-taxonomy-version", "url": "#browsing-topics-types-taxonomy-version", "dfnText": "taxonomy version", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-taxonomy-version"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-taxonomy-version\u2460"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-browsing-topics-types-taxonomy-version\u2461"}], "title": "4. BrowsingTopic dictionary"}], "external": false};
window.dfnpanelData['get-descendant-topics'] = {"dfnID": "get-descendant-topics", "url": "#get-descendant-topics", "dfnText": "get descendant topics", "refSections": [{"refs": [{"id": "ref-for-get-descendant-topics"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['browsing-topics-types-model-version'] = {"dfnID": "browsing-topics-types-model-version", "url": "#browsing-topics-types-model-version", "dfnText": "model version", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-model-version"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-model-version\u2460"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-browsing-topics-types-model-version\u2461"}], "title": "4. BrowsingTopic dictionary"}], "external": false};
window.dfnpanelData['browsing-topics-types-model'] = {"dfnID": "browsing-topics-types-model", "url": "#browsing-topics-types-model", "dfnText": "model", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-model"}], "title": "3. User agent associated state"}], "external": false};
window.dfnpanelData['classify'] = {"dfnID": "classify", "url": "#classify", "dfnText": "classify", "refSections": [{"refs": [{"id": "ref-for-classify"}], "title": "9. Derive top 5 topics"}, {"refs": [{"id": "ref-for-classify\u2460"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['browsing-topics-types-configuration-version'] = {"dfnID": "browsing-topics-types-configuration-version", "url": "#browsing-topics-types-configuration-version", "dfnText": "configuration version", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-configuration-version"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-configuration-version\u2460"}, {"id": "ref-for-browsing-topics-types-configuration-version\u2461"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-browsing-topics-types-configuration-version\u2462"}], "title": "4. BrowsingTopic dictionary"}], "external": false};
window.dfnpanelData['browsing-topics-types-version'] = {"dfnID": "browsing-topics-types-version", "url": "#browsing-topics-types-version", "dfnText": "version", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-version"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-version\u2460"}], "title": "4. BrowsingTopic dictionary"}, {"refs": [{"id": "ref-for-browsing-topics-types-version\u2461"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['browsing-topics-types-maximum-version-string-length'] = {"dfnID": "browsing-topics-types-maximum-version-string-length", "url": "#browsing-topics-types-maximum-version-string-length", "dfnText": "maximum version string length", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-maximum-version-string-length"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-maximum-version-string-length\u2460"}, {"id": "ref-for-browsing-topics-types-maximum-version-string-length\u2461"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['browsing-topics-types-user-topics-state'] = {"dfnID": "browsing-topics-types-user-topics-state", "url": "#browsing-topics-types-user-topics-state", "dfnText": "user topics state", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-user-topics-state"}], "title": "3. User agent associated state"}], "external": false};
window.dfnpanelData['user-topics-state-epochs'] = {"dfnID": "user-topics-state-epochs", "url": "#user-topics-state-epochs", "dfnText": "epochs", "refSections": [{"refs": [{"id": "ref-for-user-topics-state-epochs"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-user-topics-state-epochs\u2460"}, {"id": "ref-for-user-topics-state-epochs\u2461"}, {"id": "ref-for-user-topics-state-epochs\u2462"}, {"id": "ref-for-user-topics-state-epochs\u2463"}, {"id": "ref-for-user-topics-state-epochs\u2464"}, {"id": "ref-for-user-topics-state-epochs\u2465"}, {"id": "ref-for-user-topics-state-epochs\u2466"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-user-topics-state-epochs\u2467"}], "title": "11. Epochs for caller"}], "external": false};
window.dfnpanelData['user-topics-state-hmac-key'] = {"dfnID": "user-topics-state-hmac-key", "url": "#user-topics-state-hmac-key", "dfnText": "hmac key", "refSections": [{"refs": [{"id": "ref-for-user-topics-state-hmac-key"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-user-topics-state-hmac-key\u2460"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-user-topics-state-hmac-key\u2461"}, {"id": "ref-for-user-topics-state-hmac-key\u2462"}, {"id": "ref-for-user-topics-state-hmac-key\u2463"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['browsing-topics-types-epoch'] = {"dfnID": "browsing-topics-types-epoch", "url": "#browsing-topics-types-epoch", "dfnText": "epoch", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-epoch"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-epoch\u2460"}, {"id": "ref-for-browsing-topics-types-epoch\u2461"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-browsing-topics-types-epoch\u2462"}], "title": "11. Epochs for caller"}], "external": false};
window.dfnpanelData['epoch-taxonomy'] = {"dfnID": "epoch-taxonomy", "url": "#epoch-taxonomy", "dfnText": "taxonomy", "refSections": [{"refs": [{"id": "ref-for-epoch-taxonomy"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-epoch-taxonomy\u2460"}, {"id": "ref-for-epoch-taxonomy\u2461"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['epoch-taxonomy-version'] = {"dfnID": "epoch-taxonomy-version", "url": "#epoch-taxonomy-version", "dfnText": "taxonomy version", "refSections": [{"refs": [{"id": "ref-for-epoch-taxonomy-version"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-epoch-taxonomy-version\u2460"}, {"id": "ref-for-epoch-taxonomy-version\u2461"}], "title": "12. Get the number of distinct versions in epochs"}, {"refs": [{"id": "ref-for-epoch-taxonomy-version\u2462"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['epoch-model-version'] = {"dfnID": "epoch-model-version", "url": "#epoch-model-version", "dfnText": "model version", "refSections": [{"refs": [{"id": "ref-for-epoch-model-version"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-epoch-model-version\u2460"}], "title": "12. Get the number of distinct versions in epochs"}, {"refs": [{"id": "ref-for-epoch-model-version\u2461"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['epoch-config-version'] = {"dfnID": "epoch-config-version", "url": "#epoch-config-version", "dfnText": "config version", "refSections": [{"refs": [{"id": "ref-for-epoch-config-version"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-epoch-config-version\u2460"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['epoch-top-5-topics-with-caller-domains'] = {"dfnID": "epoch-top-5-topics-with-caller-domains", "url": "#epoch-top-5-topics-with-caller-domains", "dfnText": "top 5 topics with caller domains", "refSections": [{"refs": [{"id": "ref-for-epoch-top-5-topics-with-caller-domains"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-epoch-top-5-topics-with-caller-domains\u2460"}, {"id": "ref-for-epoch-top-5-topics-with-caller-domains\u2461"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['epoch-time'] = {"dfnID": "epoch-time", "url": "#epoch-time", "dfnText": "time", "refSections": [{"refs": [{"id": "ref-for-epoch-time"}, {"id": "ref-for-epoch-time\u2460"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-epoch-time\u2461"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-epoch-time\u2462"}, {"id": "ref-for-epoch-time\u2463"}, {"id": "ref-for-epoch-time\u2464"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['browsing-topics-types-topic-with-caller-domains'] = {"dfnID": "browsing-topics-types-topic-with-caller-domains", "url": "#browsing-topics-types-topic-with-caller-domains", "dfnText": "topic with caller domains", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-topic-with-caller-domains"}], "title": "2. Terminology and types"}, {"refs": [{"id": "ref-for-browsing-topics-types-topic-with-caller-domains\u2460"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['topic-with-caller-domains-topic-id'] = {"dfnID": "topic-with-caller-domains-topic-id", "url": "#topic-with-caller-domains-topic-id", "dfnText": "topic id", "refSections": [{"refs": [{"id": "ref-for-topic-with-caller-domains-topic-id"}, {"id": "ref-for-topic-with-caller-domains-topic-id\u2460"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-topic-with-caller-domains-topic-id\u2461"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['topic-with-caller-domains-caller-domains'] = {"dfnID": "topic-with-caller-domains-caller-domains", "url": "#topic-with-caller-domains-caller-domains", "dfnText": "caller domains", "refSections": [{"refs": [{"id": "ref-for-topic-with-caller-domains-caller-domains"}, {"id": "ref-for-topic-with-caller-domains-caller-domains\u2460"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-topic-with-caller-domains-caller-domains\u2461"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['browsing-topics-types-topics-history-entry'] = {"dfnID": "browsing-topics-types-topics-history-entry", "url": "#browsing-topics-types-topics-history-entry", "dfnText": "topics history entry", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-topics-history-entry"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-browsing-topics-types-topics-history-entry\u2460"}, {"id": "ref-for-browsing-topics-types-topics-history-entry\u2461"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-browsing-topics-types-topics-history-entry\u2462"}, {"id": "ref-for-browsing-topics-types-topics-history-entry\u2463"}], "title": "8. Collect topics caller domain"}, {"refs": [{"id": "ref-for-browsing-topics-types-topics-history-entry\u2464"}, {"id": "ref-for-browsing-topics-types-topics-history-entry\u2465"}, {"id": "ref-for-browsing-topics-types-topics-history-entry\u2466"}], "title": "9. Derive top 5 topics"}, {"refs": [{"id": "ref-for-browsing-topics-types-topics-history-entry\u2467"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['topics-history-entry-document-id'] = {"dfnID": "topics-history-entry-document-id", "url": "#topics-history-entry-document-id", "dfnText": "document id", "refSections": [{"refs": [{"id": "ref-for-topics-history-entry-document-id"}, {"id": "ref-for-topics-history-entry-document-id\u2460"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-topics-history-entry-document-id\u2461"}, {"id": "ref-for-topics-history-entry-document-id\u2462"}], "title": "8. Collect topics caller domain"}], "external": false};
window.dfnpanelData['topics-history-entry-topics-calculation-input-data'] = {"dfnID": "topics-history-entry-topics-calculation-input-data", "url": "#topics-history-entry-topics-calculation-input-data", "dfnText": "topics calculation input data", "refSections": [{"refs": [{"id": "ref-for-topics-history-entry-topics-calculation-input-data"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-topics-history-entry-topics-calculation-input-data\u2460"}], "title": "9. Derive top 5 topics"}, {"refs": [{"id": "ref-for-topics-history-entry-topics-calculation-input-data\u2461"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['topics-history-entry-time'] = {"dfnID": "topics-history-entry-time", "url": "#topics-history-entry-time", "dfnText": "time", "refSections": [{"refs": [{"id": "ref-for-topics-history-entry-time"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-topics-history-entry-time\u2460"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['topics-history-entry-topics-caller-domains'] = {"dfnID": "topics-history-entry-topics-caller-domains", "url": "#topics-history-entry-topics-caller-domains", "dfnText": "topics caller domains", "refSections": [{"refs": [{"id": "ref-for-topics-history-entry-topics-caller-domains"}], "title": "8. Collect topics caller domain"}, {"refs": [{"id": "ref-for-topics-history-entry-topics-caller-domains\u2460"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['browsing-topics-types-topics-caller-context'] = {"dfnID": "browsing-topics-types-topics-caller-context", "url": "#browsing-topics-types-topics-caller-context", "dfnText": "topics caller context", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-types-topics-caller-context"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-browsing-topics-types-topics-caller-context\u2460"}], "title": "12. Get the number of distinct versions in epochs"}, {"refs": [{"id": "ref-for-browsing-topics-types-topics-caller-context\u2461"}], "title": "13. Topics for caller"}, {"refs": [{"id": "ref-for-browsing-topics-types-topics-caller-context\u2462"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-browsing-topics-types-topics-caller-context\u2463"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['topics-caller-context-caller-domain'] = {"dfnID": "topics-caller-context-caller-domain", "url": "#topics-caller-context-caller-domain", "dfnText": "caller domain", "refSections": [{"refs": [{"id": "ref-for-topics-caller-context-caller-domain"}], "title": "13. Topics for caller"}, {"refs": [{"id": "ref-for-topics-caller-context-caller-domain\u2460"}, {"id": "ref-for-topics-caller-context-caller-domain\u2461"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-topics-caller-context-caller-domain\u2462"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['topics-caller-context-top-level-context-domain'] = {"dfnID": "topics-caller-context-top-level-context-domain", "url": "#topics-caller-context-top-level-context-domain", "dfnText": "top level context domain", "refSections": [{"refs": [{"id": "ref-for-topics-caller-context-top-level-context-domain"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-topics-caller-context-top-level-context-domain\u2460"}, {"id": "ref-for-topics-caller-context-top-level-context-domain\u2461"}, {"id": "ref-for-topics-caller-context-top-level-context-domain\u2462"}], "title": "13. Topics for caller"}, {"refs": [{"id": "ref-for-topics-caller-context-top-level-context-domain\u2463"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-topics-caller-context-top-level-context-domain\u2464"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['topics-caller-context-timestamp'] = {"dfnID": "topics-caller-context-timestamp", "url": "#topics-caller-context-timestamp", "dfnText": "timestamp", "refSections": [{"refs": [{"id": "ref-for-topics-caller-context-timestamp"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-topics-caller-context-timestamp\u2460"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-topics-caller-context-timestamp\u2461"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['user-agent-user-topics-state'] = {"dfnID": "user-agent-user-topics-state", "url": "#user-agent-user-topics-state", "dfnText": "user topics state", "refSections": [{"refs": [{"id": "ref-for-user-agent-user-topics-state"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-user-agent-user-topics-state\u2460"}, {"id": "ref-for-user-agent-user-topics-state\u2461"}, {"id": "ref-for-user-agent-user-topics-state\u2462"}, {"id": "ref-for-user-agent-user-topics-state\u2463"}, {"id": "ref-for-user-agent-user-topics-state\u2464"}, {"id": "ref-for-user-agent-user-topics-state\u2465"}, {"id": "ref-for-user-agent-user-topics-state\u2466"}], "title": "10. Periodically calculate user topics"}, {"refs": [{"id": "ref-for-user-agent-user-topics-state\u2467"}, {"id": "ref-for-user-agent-user-topics-state\u2468"}], "title": "11. Epochs for caller"}, {"refs": [{"id": "ref-for-user-agent-user-topics-state\u2460\u24ea"}, {"id": "ref-for-user-agent-user-topics-state\u2460\u2460"}, {"id": "ref-for-user-agent-user-topics-state\u2460\u2461"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['user-agent-topics-history-storage'] = {"dfnID": "user-agent-topics-history-storage", "url": "#user-agent-topics-history-storage", "dfnText": "topics history storage", "refSections": [{"refs": [{"id": "ref-for-user-agent-topics-history-storage"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-user-agent-topics-history-storage\u2460"}, {"id": "ref-for-user-agent-topics-history-storage\u2461"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-user-agent-topics-history-storage\u2462"}, {"id": "ref-for-user-agent-topics-history-storage\u2463"}], "title": "8. Collect topics caller domain"}, {"refs": [{"id": "ref-for-user-agent-topics-history-storage\u2464"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['user-agent-taxonomy'] = {"dfnID": "user-agent-taxonomy", "url": "#user-agent-taxonomy", "dfnText": "taxonomy", "refSections": [{"refs": [{"id": "ref-for-user-agent-taxonomy"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-user-agent-taxonomy\u2460"}], "title": "9. Derive top 5 topics"}, {"refs": [{"id": "ref-for-user-agent-taxonomy\u2461"}, {"id": "ref-for-user-agent-taxonomy\u2462"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['user-agent-taxonomy-version'] = {"dfnID": "user-agent-taxonomy-version", "url": "#user-agent-taxonomy-version", "dfnText": "taxonomy version", "refSections": [{"refs": [{"id": "ref-for-user-agent-taxonomy-version"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['user-agent-model'] = {"dfnID": "user-agent-model", "url": "#user-agent-model", "dfnText": "model", "refSections": [{"refs": [{"id": "ref-for-user-agent-model"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-user-agent-model\u2460"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['user-agent-model-version'] = {"dfnID": "user-agent-model-version", "url": "#user-agent-model-version", "dfnText": "model version", "refSections": [{"refs": [{"id": "ref-for-user-agent-model-version"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['user-agent-configuration-version'] = {"dfnID": "user-agent-configuration-version", "url": "#user-agent-configuration-version", "dfnText": "configuration version", "refSections": [{"refs": [{"id": "ref-for-user-agent-configuration-version"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-user-agent-configuration-version\u2460"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['dictdef-browsingtopic'] = {"dfnID": "dictdef-browsingtopic", "url": "#dictdef-browsingtopic", "dfnText": "BrowsingTopic", "refSections": [{"refs": [{"id": "ref-for-dictdef-browsingtopic"}, {"id": "ref-for-dictdef-browsingtopic\u2460"}, {"id": "ref-for-dictdef-browsingtopic\u2461"}, {"id": "ref-for-dictdef-browsingtopic\u2462"}], "title": "4. BrowsingTopic dictionary"}, {"refs": [{"id": "ref-for-dictdef-browsingtopic\u2463"}, {"id": "ref-for-dictdef-browsingtopic\u2464"}, {"id": "ref-for-dictdef-browsingtopic\u2465"}, {"id": "ref-for-dictdef-browsingtopic\u2466"}], "title": "13. Topics for caller"}, {"refs": [{"id": "ref-for-dictdef-browsingtopic\u2467"}], "title": "14. The JavaScript API"}], "external": false};
window.dfnpanelData['dom-browsingtopic-topic'] = {"dfnID": "dom-browsingtopic-topic", "url": "#dom-browsingtopic-topic", "dfnText": "topic", "refSections": [{"refs": [{"id": "ref-for-dom-browsingtopic-topic"}, {"id": "ref-for-dom-browsingtopic-topic\u2460"}], "title": "4. BrowsingTopic dictionary"}, {"refs": [{"id": "ref-for-dom-browsingtopic-topic\u2461"}, {"id": "ref-for-dom-browsingtopic-topic\u2462"}, {"id": "ref-for-dom-browsingtopic-topic\u2463"}], "title": "13. Topics for caller"}, {"refs": [{"id": "ref-for-dom-browsingtopic-topic\u2464"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['dom-browsingtopic-version'] = {"dfnID": "dom-browsingtopic-version", "url": "#dom-browsingtopic-version", "dfnText": "version", "refSections": [{"refs": [{"id": "ref-for-dom-browsingtopic-version"}, {"id": "ref-for-dom-browsingtopic-version\u2460"}], "title": "4. BrowsingTopic dictionary"}, {"refs": [{"id": "ref-for-dom-browsingtopic-version\u2461"}], "title": "13. Topics for caller"}, {"refs": [{"id": "ref-for-dom-browsingtopic-version\u2462"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['dom-browsingtopic-configversion'] = {"dfnID": "dom-browsingtopic-configversion", "url": "#dom-browsingtopic-configversion", "dfnText": "configVersion", "refSections": [{"refs": [{"id": "ref-for-dom-browsingtopic-configversion"}, {"id": "ref-for-dom-browsingtopic-configversion\u2460"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['dom-browsingtopic-modelversion'] = {"dfnID": "dom-browsingtopic-modelversion", "url": "#dom-browsingtopic-modelversion", "dfnText": "modelVersion", "refSections": [{"refs": [{"id": "ref-for-dom-browsingtopic-modelversion"}, {"id": "ref-for-dom-browsingtopic-modelversion\u2460"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['dom-browsingtopic-taxonomyversion'] = {"dfnID": "dom-browsingtopic-taxonomyversion", "url": "#dom-browsingtopic-taxonomyversion", "dfnText": "taxonomyVersion", "refSections": [{"refs": [{"id": "ref-for-dom-browsingtopic-taxonomyversion"}, {"id": "ref-for-dom-browsingtopic-taxonomyversion\u2460"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['browsing-topics-dictionary-less-than-comparator'] = {"dfnID": "browsing-topics-dictionary-less-than-comparator", "url": "#browsing-topics-dictionary-less-than-comparator", "dfnText": "code unit less than", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-dictionary-less-than-comparator"}, {"id": "ref-for-browsing-topics-dictionary-less-than-comparator"}, {"id": "ref-for-browsing-topics-dictionary-less-than-comparator\u2460"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['document-id-header-document-id'] = {"dfnID": "document-id-header-document-id", "url": "#document-id-header-document-id", "dfnText": "document id", "refSections": [{"refs": [{"id": "ref-for-document-id-header-document-id"}], "title": "7. Collect page topics calculation input data"}, {"refs": [{"id": "ref-for-document-id-header-document-id\u2460"}], "title": "8. Collect topics caller domain"}], "external": false};
window.dfnpanelData['determine-topics-calculation-input-data-header-topics-calculation-input-data'] = {"dfnID": "determine-topics-calculation-input-data-header-topics-calculation-input-data", "url": "#determine-topics-calculation-input-data-header-topics-calculation-input-data", "dfnText": "topics calculation input data", "refSections": [{"refs": [{"id": "ref-for-determine-topics-calculation-input-data-header-topics-calculation-input-data"}, {"id": "ref-for-determine-topics-calculation-input-data-header-topics-calculation-input-data\u2460"}], "title": "6. Determine topics calculation input data"}, {"refs": [{"id": "ref-for-determine-topics-calculation-input-data-header-topics-calculation-input-data\u2461"}], "title": "7. Collect page topics calculation input data"}], "external": false};
window.dfnpanelData['collect-page-topics-calculation-input-data'] = {"dfnID": "collect-page-topics-calculation-input-data", "url": "#collect-page-topics-calculation-input-data", "dfnText": "collect page topics calculation input data", "refSections": [{"refs": [{"id": "ref-for-collect-page-topics-calculation-input-data"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-collect-page-topics-calculation-input-data\u2460"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": false};
window.dfnpanelData['collect-topics-caller-domain'] = {"dfnID": "collect-topics-caller-domain", "url": "#collect-topics-caller-domain", "dfnText": "collect topics caller domain", "refSections": [{"refs": [{"id": "ref-for-collect-topics-caller-domain"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-collect-topics-caller-domain\u2460"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": false};
window.dfnpanelData['derive-top-5-topics'] = {"dfnID": "derive-top-5-topics", "url": "#derive-top-5-topics", "dfnText": "derive top 5 topics", "refSections": [{"refs": [{"id": "ref-for-derive-top-5-topics"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['schedule-user-topics-calculation'] = {"dfnID": "schedule-user-topics-calculation", "url": "#schedule-user-topics-calculation", "dfnText": "schedule user topics calculation", "refSections": [{"refs": [{"id": "ref-for-schedule-user-topics-calculation"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['calculate-user-topics'] = {"dfnID": "calculate-user-topics", "url": "#calculate-user-topics", "dfnText": "calculate user topics", "refSections": [{"refs": [{"id": "ref-for-calculate-user-topics"}], "title": "3. User agent associated state"}, {"refs": [{"id": "ref-for-calculate-user-topics\u2460"}, {"id": "ref-for-calculate-user-topics\u2461"}, {"id": "ref-for-calculate-user-topics\u2462"}], "title": "10. Periodically calculate user topics"}], "external": false};
window.dfnpanelData['calculate-the-epochs-for-caller'] = {"dfnID": "calculate-the-epochs-for-caller", "url": "#calculate-the-epochs-for-caller", "dfnText": "calculate the epochs for caller", "refSections": [{"refs": [{"id": "ref-for-calculate-the-epochs-for-caller"}], "title": "12. Get the number of distinct versions in epochs"}, {"refs": [{"id": "ref-for-calculate-the-epochs-for-caller\u2460"}], "title": "13. Topics for caller"}], "external": false};
window.dfnpanelData['get-the-number-of-distinct-versions-in-epochs'] = {"dfnID": "get-the-number-of-distinct-versions-in-epochs", "url": "#get-the-number-of-distinct-versions-in-epochs", "dfnText": "get the number of distinct versions in epochs", "refSections": [{"refs": [{"id": "ref-for-get-the-number-of-distinct-versions-in-epochs"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['calculate-the-topics-for-caller'] = {"dfnID": "calculate-the-topics-for-caller", "url": "#calculate-the-topics-for-caller", "dfnText": "calculate the topics for caller", "refSections": [{"refs": [{"id": "ref-for-calculate-the-topics-for-caller"}], "title": "14. The JavaScript API"}, {"refs": [{"id": "ref-for-calculate-the-topics-for-caller\u2460"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['dictdef-browsingtopicsoptions'] = {"dfnID": "dictdef-browsingtopicsoptions", "url": "#dictdef-browsingtopicsoptions", "dfnText": "BrowsingTopicsOptions", "refSections": [{"refs": [{"id": "ref-for-dictdef-browsingtopicsoptions"}], "title": "14. The JavaScript API"}], "external": false};
window.dfnpanelData['dom-browsingtopicsoptions-skipobservation'] = {"dfnID": "dom-browsingtopicsoptions-skipobservation", "url": "#dom-browsingtopicsoptions-skipobservation", "dfnText": "skipObservation", "refSections": [{"refs": [{"id": "ref-for-dom-browsingtopicsoptions-skipobservation"}], "title": "14. The JavaScript API"}], "external": false};
window.dfnpanelData['dom-document-browsingtopics'] = {"dfnID": "dom-document-browsingtopics", "url": "#dom-document-browsingtopics", "dfnText": "browsingTopics(options)", "refSections": [{"refs": [{"id": "ref-for-dom-document-browsingtopics"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-dom-document-browsingtopics\u2460"}], "title": "14. The JavaScript API"}], "external": false};
window.dfnpanelData['browsing-topics-task-source'] = {"dfnID": "browsing-topics-task-source", "url": "#browsing-topics-task-source", "dfnText": "browsing topics task source", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-task-source"}], "title": "14. The JavaScript API"}], "external": false};
window.dfnpanelData['request-send-browsing-topics-header-boolean'] = {"dfnID": "request-send-browsing-topics-header-boolean", "url": "#request-send-browsing-topics-header-boolean", "dfnText": "send browsing topics header boolean", "refSections": [{"refs": [{"id": "ref-for-request-send-browsing-topics-header-boolean"}], "title": "15.4. Modification to request constructor steps"}, {"refs": [{"id": "ref-for-request-send-browsing-topics-header-boolean\u2460"}], "title": "15.5. Modification to \"create navigation params by fetching\" steps"}, {"refs": [{"id": "ref-for-request-send-browsing-topics-header-boolean\u2461"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}], "external": false};
window.dfnpanelData['element-attrdef-iframe-browsingtopics'] = {"dfnID": "element-attrdef-iframe-browsingtopics", "url": "#element-attrdef-iframe-browsingtopics", "dfnText": "browsingtopics", "refSections": [{"refs": [{"id": "ref-for-element-attrdef-iframe-browsingtopics"}], "title": "15.2. browsingtopics content attribute for HTMLIframeElement"}, {"refs": [{"id": "ref-for-element-attrdef-iframe-browsingtopics\u2460"}], "title": "15.5. Modification to \"create navigation params by fetching\" steps"}], "external": false};
window.dfnpanelData['dom-htmliframeelement-browsingtopics'] = {"dfnID": "dom-htmliframeelement-browsingtopics", "url": "#dom-htmliframeelement-browsingtopics", "dfnText": "browsingTopics", "refSections": [{"refs": [{"id": "ref-for-dom-htmliframeelement-browsingtopics"}], "title": "15.2. browsingtopics content attribute for HTMLIframeElement"}], "external": false};
window.dfnpanelData['dom-requestinit-browsingtopics'] = {"dfnID": "dom-requestinit-browsingtopics", "url": "#dom-requestinit-browsingtopics", "dfnText": "browsingTopics", "refSections": [{"refs": [{"id": "ref-for-dom-requestinit-browsingtopics"}], "title": "15.4. Modification to request constructor steps"}], "external": false};
window.dfnpanelData['http-headerdef-sec-browsing-topics'] = {"dfnID": "http-headerdef-sec-browsing-topics", "url": "#http-headerdef-sec-browsing-topics", "dfnText": "Sec-Browsing-Topics", "refSections": [{"refs": [{"id": "ref-for-http-headerdef-sec-browsing-topics"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-http-headerdef-sec-browsing-topics\u2460"}, {"id": "ref-for-http-headerdef-sec-browsing-topics\u2461"}], "title": "15.8. Append or modify a request Sec-Browsing-Topics header"}, {"refs": [{"id": "ref-for-http-headerdef-sec-browsing-topics\u2462"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": false};
window.dfnpanelData['append-or-modify-a-request-sec-browsing-topics-header'] = {"dfnID": "append-or-modify-a-request-sec-browsing-topics-header", "url": "#append-or-modify-a-request-sec-browsing-topics-header", "dfnText": "append or modify a request `Sec-Browsing-Topics` header", "refSections": [{"refs": [{"id": "ref-for-append-or-modify-a-request-sec-browsing-topics-header"}], "title": "15.7. Modification to HTTP-network-or-cache fetch algorithm"}], "external": false};
window.dfnpanelData['http-headerdef-observe-browsing-topics'] = {"dfnID": "http-headerdef-observe-browsing-topics", "url": "#http-headerdef-observe-browsing-topics", "dfnText": "Observe-Browsing-Topics", "refSections": [{"refs": [{"id": "ref-for-http-headerdef-observe-browsing-topics"}], "title": "15.9. The `Observe-Browsing-Topics` HTTP response header"}], "external": false};
window.dfnpanelData['handle-topics-response'] = {"dfnID": "handle-topics-response", "url": "#handle-topics-response", "dfnText": "handle topics response", "refSections": [{"refs": [{"id": "ref-for-handle-topics-response"}], "title": "15.10. Modification to HTTP fetch steps"}], "external": false};
window.dfnpanelData['browsing-topics-policy-controlled-feature'] = {"dfnID": "browsing-topics-policy-controlled-feature", "url": "#browsing-topics-policy-controlled-feature", "dfnText": "browsing-topics", "refSections": [{"refs": [{"id": "ref-for-browsing-topics-policy-controlled-feature"}], "title": "14. The JavaScript API"}], "external": false};
window.dfnpanelData['interest-cohort-policy-controlled-feature'] = {"dfnID": "interest-cohort-policy-controlled-feature", "url": "#interest-cohort-policy-controlled-feature", "dfnText": "interest-cohort", "refSections": [{"refs": [{"id": "ref-for-interest-cohort-policy-controlled-feature"}], "title": "14. The JavaScript API"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
/*
Color-choosing design:

Colors are ordered by goodness.
Each color has a usage count (initially zero).
Each variable has a last-used color.

* If the var has a last-used color, and that color's usage is 0,
    return that color.
* Otherwise, return the lowest-indexed color with the lowest usage.
    Increment the color's usage and set it as the last-used color
    for that var.
* On unclicking, decrement usage of the color.
*/
"use strict";
{
    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    const indexCounts = new Map();
    const indexNames = new Map();
    function highlightSameAlgoVars(v) {
        // Find the algorithm container.
        let algoContainer = null;
        let searchEl = v;
        while(algoContainer == null && searchEl != document.body) {
            searchEl = searchEl.parentNode;
            if(searchEl.hasAttribute("data-algorithm")) {
                algoContainer = searchEl;
            }
        }

        // Not highlighting document-global vars,
        // too likely to be unrelated.
        if(algoContainer == null) return;

        const algoName = algoContainer.getAttribute("data-algorithm");
        const varName = getVarName(v);
        const addClass = !v.classList.contains("selected");
        let highlightClass = null;
        if(addClass) {
            const index = chooseHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] += 1;
            indexNames.set(algoName+"///"+varName, index);
            highlightClass = nameFromIndex(index);
        } else {
            const index = previousHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] -= 1;
            highlightClass = nameFromIndex(index);
        }

        // Find all same-name vars, and toggle their class appropriately.
        for(const el of algoContainer.querySelectorAll("var")) {
            if(getVarName(el) == varName) {
                el.classList.toggle("selected", addClass);
                el.classList.toggle(highlightClass, addClass);
            }
        }
    }
    function getVarName(el) {
        return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
    }
    function chooseHighlightIndex(algoName, varName) {
        let indexes = null;
        if(indexCounts.has(algoName)) {
            indexes = indexCounts.get(algoName);
        } else {
            // 7 classes right now
            indexes = [0,0,0,0,0,0,0];
            indexCounts.set(algoName, indexes);
        }

        // If the element was recently unclicked,
        // *and* that color is still unclaimed,
        // give it back the same color.
        const lastIndex = previousHighlightIndex(algoName, varName);
        if(indexes[lastIndex] === 0) return lastIndex;

        // Find the earliest index with the lowest count.
        const minCount = Math.min.apply(null, indexes);
        let index = null;
        for(var i = 0; i < indexes.length; i++) {
            if(indexes[i] == minCount) {
                return i;
            }
        }
    }
    function previousHighlightIndex(algoName, varName) {
        return indexNames.get(algoName+"///"+varName);
    }
    function nameFromIndex(index) {
        return "selected" + index;
    }
}
</script>